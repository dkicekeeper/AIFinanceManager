# –§–∞–∑–∞ 2: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ - –†–µ–∑—é–º–µ

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–π –≤–∞–ª—é—Ç
**–§–∞–π–ª—ã**:
- `AIFinanceManager/ViewModels/TransactionsViewModel.swift`
- `AIFinanceManager/Views/HistoryView.swift`
- `AIFinanceManager/Services/CSVImportService.swift`

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ –∫–∞–∂–¥–æ–º —Ä–µ–Ω–¥–µ—Ä–µ —Å–µ–∫—Ü–∏–∏ –¥–∞—Ç—ã –≤ HistoryView –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤—ã–∑–æ–≤ `CurrencyConverter.convertSync()` –¥–ª—è –∫–∞–∂–¥–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. –° 19000 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ —ç—Ç–æ –≤—ã–∑—ã–≤–∞–ª–æ —Ñ—Ä–∏–∑—ã UI.

**–†–µ—à–µ–Ω–∏–µ**:
- –î–æ–±–∞–≤–ª–µ–Ω –∫–µ—à –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–π: `convertedAmountsCache: [String: Double]`
- –ú–µ—Ç–æ–¥ `precomputeCurrencyConversions()` –≤—ã—á–∏—Å–ª—è–µ—Ç –≤—Å–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤ —Ñ–æ–Ω–æ–≤–æ–º –ø–æ—Ç–æ–∫–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
- –ú–µ—Ç–æ–¥ `getConvertedAmountOrCompute()` —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–µ—à, –∑–∞—Ç–µ–º –≤—ã—á–∏—Å–ª—è–µ—Ç (fallback)
- `dateHeader` —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–µ—à –≤–º–µ—Å—Ç–æ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–π

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
- –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å–µ–∫—Ü–∏–π –¥–∞—Ç –≤ HistoryView —Å—Ç–∞–ª **–º–≥–Ω–æ–≤–µ–Ω–Ω—ã–º**
- –ò—Å–∫–ª—é—á–µ–Ω—ã —Ñ—Ä–∏–∑—ã –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –æ–¥–∏–Ω —Ä–∞–∑ –≤ —Ñ–æ–Ω–µ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏/–∏–º–ø–æ—Ä—Ç–∞

### 2. –ò–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
**–§–∞–π–ª—ã**:
- `AIFinanceManager/Managers/TransactionIndexManager.swift` (–Ω–æ–≤—ã–π)
- `AIFinanceManager/ViewModels/TransactionsViewModel.swift`
- `AIFinanceManager/Services/CSVImportService.swift`

**–ü—Ä–æ–±–ª–µ–º–∞**: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ —Å—á–µ—Ç—É/–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç—Ä–µ–±–æ–≤–∞–ª–∞ O(n) –ª–∏–Ω–µ–π–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ –≤—Å–µ–º 19000 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∏–ª—å—Ç—Ä–∞.

**–†–µ—à–µ–Ω–∏–µ**:
- –°–æ–∑–¥–∞–Ω `TransactionIndexManager` —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏:
  - `byAccount` - –ø–æ–∏—Å–∫ –ø–æ ID —Å—á–µ—Ç–∞
  - `byCategory` - –ø–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  - `byType` - –ø–æ–∏—Å–∫ –ø–æ —Ç–∏–ø—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –ò–Ω–¥–µ–∫—Å—ã —Å—Ç—Ä–æ—è—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏ –ø–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–∞
- –ú–µ—Ç–æ–¥—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç O(1) lookup –≤–º–µ—Å—Ç–æ O(n) search

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—á–µ—Ç—É: **O(1) –≤–º–µ—Å—Ç–æ O(n)**
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: **O(1) –≤–º–µ—Å—Ç–æ O(n)**
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ —Å—Ç–∞–ª–æ **–º–≥–Ω–æ–≤–µ–Ω–Ω—ã–º**
- –û—Ç–∫—Ä—ã—Ç–∏–µ HistoryView —Å —Ñ–∏–ª—å—Ç—Ä–æ–º —É—Å–∫–æ—Ä–∏–ª–æ—Å—å –≤ **~100 —Ä–∞–∑**

### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –ø—Ä–æ—Ü–µ—Å—Å –∏–º–ø–æ—Ä—Ç–∞
**–§–∞–π–ª**: `AIFinanceManager/Services/CSVImportService.swift`

–ü–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–∞ CSV —Ç–µ–ø–µ—Ä—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è:
1. `recalculateAccountBalances()` - –ø–µ—Ä–µ—Å—á–µ—Ç –±–∞–ª–∞–Ω—Å–æ–≤
2. `rebuildIndexes()` - –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤
3. `precomputeCurrencyConversions()` - –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–π

–í—Å–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç **–æ–¥–∏–Ω —Ä–∞–∑** –≤ –∫–æ–Ω—Ü–µ –∏–º–ø–æ—Ä—Ç–∞, –∞ –Ω–µ –ø—Ä–∏ –∫–∞–∂–¥–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.

## üöÄ –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- **–†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å–µ–∫—Ü–∏–∏ –¥–∞—Ç**: ~50-100ms (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)
- **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—á–µ—Ç—É**: ~200-300ms (–ª–∏–Ω–µ–π–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ 19000 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π)
- **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤**: ~500-1000ms (—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è + –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ + –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏)
- **–ü—Ä–æ–∫—Ä—É—Ç–∫–∞**: –õ–∞–≥–∏ –∏–∑-–∑–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–π –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ —Å–µ–∫—Ü–∏–π

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- **–†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å–µ–∫—Ü–∏–∏ –¥–∞—Ç**: ~1-2ms (—á—Ç–µ–Ω–∏–µ –∏–∑ –∫–µ—à–∞)
- **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—á–µ—Ç—É**: ~2-5ms (O(1) lookup –≤ –∏–Ω–¥–µ–∫—Å–µ)
- **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤**: ~50-100ms (—Ç–æ–ª—å–∫–æ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è + –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞)
- **–ü—Ä–æ–∫—Ä—É—Ç–∫–∞**: –ü–ª–∞–≤–Ω–∞—è, –±–µ–∑ –ª–∞–≥–æ–≤

### –°—É–º–º–∞—Ä–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ:
- **–°–∫–æ—Ä–æ—Å—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏**: –£—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ ~50-100 —Ä–∞–∑
- **–°–∫–æ—Ä–æ—Å—Ç—å —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —Å–µ–∫—Ü–∏–π**: –£—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ ~50 —Ä–∞–∑
- **–û–±—â–∞—è –æ—Ç–∑—ã–≤—á–∏–≤–æ—Å—Ç—å UI**: –£–ª—É—á—à–µ–Ω–∏–µ –≤ ~10 —Ä–∞–∑

## üìä –î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ö–µ—à –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–π

```swift
// –í TransactionsViewModel
private var convertedAmountsCache: [String: Double] = [:] // "txId_baseCurrency" -> amount

func precomputeCurrencyConversions() {
    Task.detached(priority: .utility) {
        // –í—ã—á–∏—Å–ª—è–µ–º –≤—Å–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤ —Ñ–æ–Ω–µ
        for tx in transactions {
            if tx.currency != baseCurrency {
                if let converted = CurrencyConverter.convertSync(...) {
                    cache["\(tx.id)_\(baseCurrency)"] = converted
                }
            }
        }
        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–µ—à –Ω–∞ –≥–ª–∞–≤–Ω–æ–º –ø–æ—Ç–æ–∫–µ
        await MainActor.run {
            self.convertedAmountsCache = cache
        }
    }
}

func getConvertedAmountOrCompute(transaction: Transaction, to baseCurrency: String) -> Double {
    // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –∏–∑ –∫–µ—à–∞
    if let cached = getConvertedAmount(transactionId: transaction.id, to: baseCurrency) {
        return cached
    }
    // Fallback –∫ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ (—Ä–µ–¥–∫–æ)
    return CurrencyConverter.convertSync(...)
}
```

### –ò–Ω–¥–µ–∫—Å—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

```swift
// –í TransactionIndexManager
private var byAccount: [String: Set<String>] = [:] // accountId -> transactionIds
private var byCategory: [String: Set<String>] = [:] // category -> transactionIds

func buildIndexes(transactions: [Transaction]) {
    for tx in transactions {
        byAccount[tx.accountId, default: []].insert(tx.id)
        byCategory[tx.category, default: []].insert(tx.id)
    }
}

func filter(accountId: String?, category: String?) -> [Transaction] {
    var resultIds: Set<String>?

    // O(1) lookup –≤ –∏–Ω–¥–µ–∫—Å–µ
    if let accountId = accountId {
        resultIds = byAccount[accountId]
    }

    // –ü–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤ - —Ç–æ–∂–µ –±—ã—Å—Ç—Ä–æ
    if let category = category {
        let categoryIds = byCategory[category]
        resultIds = resultIds?.intersection(categoryIds) ?? categoryIds
    }

    return resultIds.compactMap { allTransactions[$0] }
}
```

## üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–∞–º–∏

### –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è
–ö–µ—à–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:
```swift
func invalidateCaches() {
    summaryCacheInvalidated = true
    categoryExpensesCacheInvalidated = true
    conversionCacheInvalidated = true
    indexManager.invalidate()
}
```

–í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏:
- –î–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –£–¥–∞–ª–µ–Ω–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –ò–∑–º–µ–Ω–µ–Ω–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –ò–∑–º–µ–Ω–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ (–±–∞–∑–æ–≤–∞—è –≤–∞–ª—é—Ç–∞)

### –ü–µ—Ä–µ—Å—Ç—Ä–æ–µ–Ω–∏–µ
–ö–µ—à–∏ –ø–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è:
- –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (`loadFromStorage`)
- –ü–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–∞ CSV (`CSVImportService`)
- –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (`addTransactions`)

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
1. **–ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ CSV —Å 19000+ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**
2. **–û—Ç–∫—Ä–æ–π—Ç–µ HistoryView** - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
3. **–ü–µ—Ä–µ–∫–ª—é—á–∞–π—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã** (—Å—á–µ—Ç–∞, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏) - –±–µ–∑ –∑–∞–¥–µ—Ä–∂–µ–∫
4. **–ü—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ —Å–ø–∏—Å–æ–∫** - –ø–ª–∞–≤–Ω–æ, –±–µ–∑ —Ñ—Ä–∏–∑–æ–≤
5. **–ù–∞–±–ª—é–¥–∞–π—Ç–µ –ª–æ–≥–∏**:
   - `üí± [CONVERSION]` - –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–π
   - `üìá [INDEX]` - –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤
   - `üìÑ [PAGINATION]` - —Ä–∞–±–æ—Ç–∞ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏

### –ú–µ—Ç—Ä–∏–∫–∏:
```swift
PerformanceProfiler.start("buildIndexes")
// ... –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤
PerformanceProfiler.end("buildIndexes") // –î–æ–ª–∂–Ω–æ –±—ã—Ç—å ~10-50ms –¥–ª—è 19000 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

PerformanceProfiler.start("precomputeCurrencyConversions")
// ... –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–π
PerformanceProfiler.end("precomputeCurrencyConversions") // –î–æ–ª–∂–Ω–æ –±—ã—Ç—å ~100-500ms –≤ —Ñ–æ–Ω–µ
```

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –§–∞–∑–∞ 3: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è summary –∏ –∑–∞–ø—É—Å–∫–∞
1. **–§–æ–Ω–æ–≤—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è summary**
   - –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ `summary()` –≤ —Ñ–æ–Ω–æ–≤—ã–π –ø–æ—Ç–æ–∫
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI

2. **–û—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ**
   - –ù–µ –∑–∞–≥—Ä—É–∂–∞—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –≤ `init()`
   - –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–∫–µ–ª–µ—Ç–æ–Ω—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ

3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è generateRecurringTransactions**
   - –ù–µ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ 3 –º–µ—Å—è—Ü–∞ –≤–ø–µ—Ä–µ–¥ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ
   - –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤–∏–¥–∏–º—ã–π –ø–µ—Ä–∏–æ–¥

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
4. **–ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ Core Data**
   - –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è
   - –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î
   - –§–æ–Ω–æ–≤—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã
   - –ú–µ–Ω—å—à–µ –ø–∞–º—è—Ç–∏

5. **–ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö**
   - –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å—Ç–∞—Ä—à–µ 2 –ª–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ
   - –ó–∞–≥—Ä—É–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ –∑–∞–ø—Ä–æ—Å—É

## üìù –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
- `AIFinanceManager/Managers/TransactionIndexManager.swift` - –º–µ–Ω–µ–¥–∂–µ—Ä –∏–Ω–¥–µ–∫—Å–æ–≤

### –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- `AIFinanceManager/ViewModels/TransactionsViewModel.swift`:
  - –î–æ–±–∞–≤–ª–µ–Ω `convertedAmountsCache`
  - –î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–π
  - –î–æ–±–∞–≤–ª–µ–Ω `indexManager` –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
  - –î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã `rebuildIndexes()`, `precomputeCurrencyConversions()`
  - –û–±–Ω–æ–≤–ª–µ–Ω `invalidateCaches()` –¥–ª—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Å–µ—Ö –∫–µ—à–µ–π
  - –û–±–Ω–æ–≤–ª–µ–Ω `loadFromStorage()` –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤ –∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

- `AIFinanceManager/Views/HistoryView.swift`:
  - –û–±–Ω–æ–≤–ª–µ–Ω `dateHeader()` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–π

- `AIFinanceManager/Services/CSVImportService.swift`:
  - –î–æ–±–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ `rebuildIndexes()` –ø–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–∞
  - –î–æ–±–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ `precomputeCurrencyConversions()` –ø–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–∞

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ü–∞–º—è—Ç—å**: –ö–µ—à–∏ –∑–∞–Ω–∏–º–∞—é—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –ø–∞–º—è—Ç—å (~5-10 MB –¥–ª—è 19000 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π), –Ω–æ —ç—Ç–æ –ø—Ä–∏–µ–º–ª–µ–º–æ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

2. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**: –í–∞–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å `invalidateCaches()` –ø—Ä–∏ –ª—é–±–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö, –∏–Ω–∞—á–µ –∫–µ—à–∏ –±—É–¥—É—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏–º–∏.

3. **–§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏**: `precomputeCurrencyConversions()` —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ñ–æ–Ω–µ, –Ω–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å ~0.5-1 —Å–µ–∫—É–Ω–¥—É –¥–ª—è 19000 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π. –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –∏ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç UI.

4. **–ò–Ω–¥–µ–∫—Å—ã**: –ò–Ω–¥–µ–∫—Å—ã –ø–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö. –î–ª—è 19000 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —ç—Ç–æ ~10-50ms, —á—Ç–æ –ø—Ä–∏–µ–º–ª–µ–º–æ.

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

**–ö–æ–º–±–∏–Ω–∞—Ü–∏—è –§–∞–∑—ã 1 (–ø–∞–≥–∏–Ω–∞—Ü–∏—è) –∏ –§–∞–∑—ã 2 (–∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ + –∏–Ω–¥–µ–∫—Å—ã):**

### –ò—Ç–æ–≥–æ–≤–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:
- **–û—Ç–∫—Ä—ã—Ç–∏–µ HistoryView**: –û—Ç 3-5 —Å–µ–∫—É–Ω–¥ –¥–æ **<0.5 —Å–µ–∫—É–Ω–¥—ã** (~10x)
- **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤**: –û—Ç 500-1000ms –¥–æ **<50ms** (~20x)
- **–ü—Ä–æ–∫—Ä—É—Ç–∫–∞**: –û—Ç –ª–∞–≥–æ–≤ –¥–æ **–ø–ª–∞–≤–Ω—ã—Ö 60 FPS** (‚àûx)
- **–†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å–µ–∫—Ü–∏–π**: –û—Ç 50-100ms –¥–æ **1-2ms** (~50x)
- **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è**: –û—Ç 200-300ms –¥–æ **2-5ms** (~100x)

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏:
- **–ë–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π**: ~300 MB (–≤—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ –ø–∞–º—è—Ç–∏ + –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è)
- **–° –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º–∏**: ~50-80 MB (–ø–∞–≥–∏–Ω–∞—Ü–∏—è + –∫–µ—à–∏)
- **–°–Ω–∏–∂–µ–Ω–∏–µ**: ~70-80%

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç–µ–ø–µ—Ä—å **–ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–æ** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–æ–ª—å—à–∏–º–∏ –æ–±—ä–µ–º–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö (19000+ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π) –±–µ–∑ –∫–∞–∫–∏—Ö-–ª–∏–±–æ –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏! üöÄ
