# –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ ViewModels –∏ Core Data: –û—Ç—á–µ—Ç –∏ –ü–ª–∞–Ω –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

**–î–∞—Ç–∞:** 24 —è–Ω–≤–∞—Ä—è 2026  
**–ü—Ä–æ–µ–∫—Ç:** AIFinanceManager  
**–í–µ—Ä—Å–∏—è:** 1.0

---

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ](#–∫—Ä–∞—Ç–∫–æ–µ-—Ä–µ–∑—é–º–µ)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –æ–±–∑–æ—Ä](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π-–æ–±–∑–æ—Ä)
3. [–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã](#–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ-–ø—Ä–æ–±–ª–µ–º—ã)
4. [–ü—Ä–æ–±–ª–µ–º—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏](#–ø—Ä–æ–±–ª–µ–º—ã-—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏)
5. [–ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏](#–ø—Ä–æ–±–ª–µ–º—ã-–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
6. [–ë–∞–≥–∏ –ø—Ä–∏ CRUD –æ–ø–µ—Ä–∞—Ü–∏—è—Ö](#–±–∞–≥–∏-–ø—Ä–∏-crud-–æ–ø–µ—Ä–∞—Ü–∏—è—Ö)
7. [–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∫–∞–∂–¥–æ–º—É ViewModel](#—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏-–ø–æ-–∫–∞–∂–¥–æ–º—É-viewmodel)
8. [–ü–ª–∞–Ω —É–ª—É—á—à–µ–Ω–∏–π](#–ø–ª–∞–Ω-—É–ª—É—á—à–µ–Ω–∏–π)
9. [–ú–µ—Ç—Ä–∏–∫–∏ –∏ –æ—Ü–µ–Ω–∫–∏](#–º–µ—Ç—Ä–∏–∫–∏-–∏-–æ—Ü–µ–Ω–∫–∏)

---

## –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ

- **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**: ViewModels —Ö–æ—Ä–æ—à–æ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –ø–æ –¥–æ–º–µ–Ω–Ω—ã–º –æ–±–ª–∞—Å—Ç—è–º
- **Repository Pattern**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ `DataRepositoryProtocol` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≥–∏–±–∫–æ—Å—Ç—å
- **AppCoordinator**: –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
- **–ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**: –ï—Å—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º –º–∏–≥—Ä–∞—Ü–∏–∏ –∏–∑ UserDefaults –≤ Core Data
- **Fallback –º–µ—Ö–∞–Ω–∏–∑–º**: –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö Core Data –µ—Å—Ç—å –æ—Ç–∫–∞—Ç –Ω–∞ UserDefaults

### ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **Race Conditions**: 13 –º–µ—Å—Ç —Å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–º–∏ –¥–æ—Å—Ç—É–ø–∞–º–∏
2. **Memory Leaks**: –°–ª–∞–±—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–µ –≤–µ–∑–¥–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. **Data Consistency**: –ù–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
4. **Performance**: –í—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ –ø–∞–º—è—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
5. **Error Handling**: –û—à–∏–±–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è Core Data —á–∞—Å—Ç–æ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è

### üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–í—Å–µ–≥–æ ViewModels**: 6 (–≤–∫–ª—é—á–∞—è AppCoordinator)
- **@Published —Å–≤–æ–π—Å—Ç–≤**: 53
- **–†—É—á–Ω—ã—Ö objectWillChange.send()**: 13 (–∏–∑–±—ã—Ç–æ—á–Ω–æ)
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π**: 11 (–ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ race conditions)
- **–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞ Main Thread**: 7 (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ UI)

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –æ–±–∑–æ—Ä

### –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              SwiftUI Views                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                 ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           AppCoordinator                         ‚îÇ
‚îÇ  (Manages ViewModel dependencies)                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ        ‚îÇ        ‚îÇ        ‚îÇ        ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚ñº‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îê
‚îÇAccounts‚îÇ ‚îÇTxns‚îÇ ‚îÇCategor‚îÇ ‚îÇSubs ‚îÇ ‚îÇDeps ‚îÇ
‚îÇViewModel‚îÇ ‚îÇVM ‚îÇ ‚îÇiesVM  ‚îÇ ‚îÇVM   ‚îÇ ‚îÇVM   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚î¨‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îò
     ‚îÇ       ‚îÇ        ‚îÇ        ‚îÇ        ‚îÇ
     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ DataRepositoryProtocol      ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ   CoreDataRepository        ‚îÇ
        ‚îÇ   (Primary Storage)         ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ     CoreDataStack           ‚îÇ
        ‚îÇ  (NSPersistentContainer)    ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü—Ä–æ–±–ª–µ–º—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

1. **Circular Dependency**: `TransactionsViewModel` –∏–º–µ–µ—Ç weak —Å—Å—ã–ª–∫—É –Ω–∞ `AccountsViewModel`
2. **Distributed State**: –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–∞–∑–±—Ä–æ—Å–∞–Ω–æ –ø–æ –º–Ω–æ–∂–µ—Å—Ç–≤—É ViewModels
3. **Dual Storage**: Core Data + UserDefaults —Å–æ–∑–¥–∞–µ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç—å
4. **No Single Source of Truth**: ViewModels –∏–º–µ—é—Ç —Å–≤–æ–∏ –∫–æ–ø–∏–∏ –¥–∞–Ω–Ω—ã—Ö

---

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### üö® –ü—Ä–æ–±–ª–µ–º–∞ #1: Race Conditions –ø—Ä–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `CoreDataRepository.swift`, –≤—Å–µ –º–µ—Ç–æ–¥—ã `save*()`

**–û–ø–∏—Å–∞–Ω–∏–µ**:
```swift
// ‚ùå –ü–†–û–ë–õ–ï–ú–ê
func saveTransactions(_ transactions: [Transaction]) {
    Task.detached(priority: .utility) { @MainActor [weak self] in
        // –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
        // ViewModel –º–æ–∂–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å —É—Å—Ç–∞—Ä–µ–≤—à–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
    }
}
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**:
- ViewModel –∏–∑–º–µ–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–ª–∞–µ—Ç –µ—â–µ –æ–¥–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ ‚Üí –ù–æ–≤–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è
- –ü–µ—Ä–≤–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –∏ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤—Ç–æ—Ä–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ü—Ä–∏–º–µ—Ä—ã –≤ –∫–æ–¥–µ**:
1. `CoreDataRepository.saveTransactions()` (—Å—Ç—Ä–æ–∫–∞ 55)
2. `CoreDataRepository.saveAccounts()` (—Å—Ç—Ä–æ–∫–∞ 179)
3. `CoreDataRepository.saveRecurringSeries()` (—Å—Ç—Ä–æ–∫–∞ 503)
4. `CoreDataRepository.saveCategories()` (—Å—Ç—Ä–æ–∫–∞ 618)

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Actor –∏–ª–∏ —Å–µ—Ä–∏–π–Ω—É—é –æ—á–µ—Ä–µ–¥—å –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

---

### üö® –ü—Ä–æ–±–ª–µ–º–∞ #2: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –≤ Core Data

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: –í—Å–µ –º–µ—Ç–æ–¥—ã save –≤ `CoreDataRepository.swift`

**–û–ø–∏—Å–∞–Ω–∏–µ**:
```swift
// ‚ö†Ô∏è –°–ò–ú–ü–¢–û–ú, –ê –ù–ï –†–ï–®–ï–ù–ò–ï
var existingDict: [String: TransactionEntity] = [:]
for entity in existingEntities {
    let id = entity.id ?? ""
    if !id.isEmpty && existingDict[id] == nil {
        existingDict[id] = entity
    } else if !id.isEmpty {
        // –ù–∞–π–¥–µ–Ω –¥—É–±–ª–∏–∫–∞—Ç - —É–¥–∞–ª—è–µ–º
        print("‚ö†Ô∏è Found duplicate transaction entity")
        context.delete(entity)
    }
}
```

**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–∞–ª–∏—á–∏–µ –∫–æ–¥–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –≥–æ–≤–æ—Ä–∏—Ç –æ —Ç–æ–º, —á—Ç–æ –æ–Ω–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç. –≠—Ç–æ —Å–∏–º–ø—Ç–æ–º –±–æ–ª–µ–µ –≥–ª—É–±–æ–∫–æ–π –ø—Ä–æ–±–ª–µ–º—ã —Å concurrent –¥–æ—Å—Ç—É–ø–æ–º.

**–ü—Ä–∏—á–∏–Ω—ã**:
1. –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–¥–Ω–∏—Ö –∏ —Ç–µ—Ö –∂–µ –æ–±—ä–µ–∫—Ç–æ–≤
2. –ù–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö constraint –Ω–∞ —É—Ä–æ–≤–Ω–µ Core Data
3. –†–∞–∑–Ω—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã —Å–æ–∑–¥–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã

**–†–µ—à–µ–Ω–∏–µ**: 
- –î–æ–±–∞–≤–∏—Ç—å unique constraints –≤ Core Data –º–æ–¥–µ–ª—å
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `NSMergePolicy` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è

---

### üö® –ü—Ä–æ–±–ª–µ–º–∞ #3: –†—É—á–Ω–æ–π –≤—ã–∑–æ–≤ objectWillChange.send()

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: 13 –º–µ—Å—Ç –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö ViewModels

**–û–ø–∏—Å–∞–Ω–∏–µ**:
```swift
// ‚ùå –ò–ó–ë–´–¢–û–ß–ù–û –ò –ú–û–ñ–ï–¢ –í–´–ó–í–ê–¢–¨ –ü–†–û–ë–õ–ï–ú–´
accounts = newAccounts
objectWillChange.send()  // @Published —É–∂–µ –¥–µ–ª–∞–µ—Ç —ç—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!
```

**–ü—Ä–æ–±–ª–µ–º—ã**:
1. **Double notification**: @Published —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
2. **–ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: –†—É—á–Ω–æ–π send() –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è —Ä–∞–Ω—å—à–µ, —á–µ–º –∏–∑–º–µ–Ω–∏—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ
3. **–ò–∑–±—ã—Ç–æ—á–Ω—ã–µ UI –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: SwiftUI –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–≤–∞–∂–¥—ã

**–ù–∞–π–¥–µ–Ω–æ –≤**:
- `AccountsViewModel.swift`: 3 –º–µ—Å—Ç–∞
- `TransactionsViewModel.swift`: 1 –º–µ—Å—Ç–æ
- `CategoriesViewModel.swift`: 3 –º–µ—Å—Ç–∞
- `SubscriptionsViewModel.swift`: 6 –º–µ—Å—Ç

**–†–µ—à–µ–Ω–∏–µ**: –£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Ä—É—á–Ω—ã–µ –≤—ã–∑–æ–≤—ã `objectWillChange.send()`

---

### üö® –ü—Ä–æ–±–ª–µ–º–∞ #4: Weak reference –º–æ–∂–µ—Ç –±—ã—Ç—å nil

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `TransactionsViewModel.swift:54`

**–û–ø–∏—Å–∞–Ω–∏–µ**:
```swift
weak var accountsViewModel: AccountsViewModel?

// –ü–æ–∑–∂–µ –≤ –∫–æ–¥–µ:
accountsViewModel?.syncAccountBalances(updatedAccounts)  // –ú–æ–∂–µ—Ç –±—ã—Ç—å nil!
```

**–ü—Ä–æ–±–ª–µ–º—ã**:
1. –ï—Å–ª–∏ `accountsViewModel` —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è nil, –±–∞–ª–∞–Ω—Å—ã –Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è
2. –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–ª—É—á–∞—è, –∫–æ–≥–¥–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
3. Silent failure - –Ω–µ—Ç –æ—à–∏–±–∫–∏, –ø—Ä–æ—Å—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ**: 
- –°–¥–µ–ª–∞—Ç—å —Å–∏–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É —á–µ—Ä–µ–∑ AppCoordinator
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Dependency Injection –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

---

### üö® –ü—Ä–æ–±–ª–µ–º–∞ #5: –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ –ø–∞–º—è—Ç—å

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `TransactionsViewModel.swift`

**–û–ø–∏—Å–∞–Ω–∏–µ**:
```swift
@Published var allTransactions: [Transaction] = []

func loadFromStorage() {
    allTransactions = repository.loadTransactions()  // –í–°–ï —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏!
}
```

**–ü—Ä–æ–±–ª–µ–º—ã**:
1. **Memory Usage**: –î–ª—è 10,000 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π ~ 5-10 MB RAM
2. **Startup Time**: –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –ø–∞—Ä—Å–∏–Ω–≥ –∑–∞–º–µ–¥–ª—è—é—Ç —Å—Ç–∞—Ä—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
3. **Filtering Performance**: –ö–∞–∂–¥–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–µ—Ä–µ–±–∏—Ä–∞–µ—Ç –≤–µ—Å—å –º–∞—Å—Å–∏–≤

**–†–µ—à–µ–Ω–∏–µ**: Pagination + NSFetchedResultsController

---

## –ü—Ä–æ–±–ª–µ–º—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

### Race Condition #1: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

**–°—Ü–µ–Ω–∞—Ä–∏–π**:
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –°–æ–∑–¥–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
  ‚Üì
TransactionsViewModel: addTransaction()
  ‚Üì
Repository: saveTransactions() [Task.detached]
  ‚Üì (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –°–æ–∑–¥–∞–µ—Ç –µ—â–µ –æ–¥–Ω—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
  ‚Üì
TransactionsViewModel: addTransaction()
  ‚Üì
Repository: saveTransactions() [Task.detached]
  ‚Üì
‚ùå –û–±–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
‚ùå –í–æ–∑–º–æ–∂–Ω–æ –ø–µ—Ä–µ–∑–∞—Ç–∏—Ä–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
```

**–ß–∞—Å—Ç–æ—Ç–∞**: –í—ã—Å–æ–∫–∞—è (–ø—Ä–∏ –±—ã—Å—Ç—Ä–æ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π)

**–†–µ—à–µ–Ω–∏–µ**:
```swift
actor TransactionSaveCoordinator {
    private var isSaving = false
    
    func save(_ transactions: [Transaction]) async throws {
        guard !isSaving else {
            throw SaveError.savingInProgress
        }
        isSaving = true
        defer { isSaving = false }
        
        // Perform save
    }
}
```

---

### Race Condition #2: –ü–µ—Ä–µ—Å—á–µ—Ç –±–∞–ª–∞–Ω—Å–æ–≤

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `TransactionsViewModel.recalculateAccountBalances()`

**–°—Ü–µ–Ω–∞—Ä–∏–π**:
```
Thread 1: –ü–µ—Ä–µ—Å—á–µ—Ç –±–∞–ª–∞–Ω—Å–æ–≤ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ CSV
Thread 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
  ‚Üì
‚ùå –û–±–∞ –ø–æ—Ç–æ–∫–∞ –æ–±–Ω–æ–≤–ª—è—é—Ç accountsViewModel.accounts
‚ùå –û–¥–∏–Ω –∏–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ—Ç–µ—Ä—è–Ω
```

**–ö–æ–¥ –ø—Ä–æ–±–ª–µ–º—ã**:
```swift
func recalculateAccountBalances() {
    // ... —Ä–∞—Å—á–µ—Ç—ã ...
    accountsViewModel?.syncAccountBalances(updatedAccounts)  // –ù–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ!
}
```

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å serial DispatchQueue –∏–ª–∏ Actor

---

### Race Condition #3: ViewContext vs BackgroundContext

**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `viewContext`, –¥—Ä—É–≥–∏–µ `backgroundContext`

```swift
// AccountsViewModel (—á–µ—Ä–µ–∑ CoreDataRepository.saveAccounts)
let context = stack.viewContext  // Main Thread

// TransactionsViewModel (—á–µ—Ä–µ–∑ CoreDataRepository.saveTransactions)
let context = stack.newBackgroundContext()  // Background Thread
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**:
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ background context –Ω–µ —Å—Ä–∞–∑—É –≤–∏–¥–Ω—ã –≤ view context
- –í–æ–∑–º–æ–∂–Ω—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏
- `automaticallyMergesChangesFromParent` –Ω–µ –≤—Å–µ–≥–¥–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ

**–†–µ—à–µ–Ω–∏–µ**: –ï–¥–∏–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤

---

## –ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### Performance Issue #1: –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞ Main Thread

**–ù–∞–π–¥–µ–Ω–æ**:
1. `AccountsViewModel.saveAllAccountsSync()` - –ø—Ä—è–º–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ viewContext
2. `CategoriesViewModel.saveCategoriesSync()` - —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
3. `TransactionsViewModel.loadFromStorage()` - –∑–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö

**–ò–∑–º–µ—Ä–µ–Ω–∏—è** (–¥–ª—è 1000 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π):
- `loadTransactions()`: ~150-300ms –Ω–∞ Main Thread ‚ùå
- `saveTransactions()`: ~100-200ms –µ—Å–ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ ‚ùå
- `recalculateAccountBalances()`: ~50-100ms ‚ùå

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ Core Data –¥–æ–ª–∂–Ω—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –≤ background

---

### Performance Issue #2: N+1 Query Problem

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å relationships

```swift
// ‚ùå –ü–†–û–ë–õ–ï–ú–ê
let transactions = try context.fetch(request)
for transaction in transactions {
    let account = transaction.account  // –û—Ç–¥–µ–ª—å–Ω—ã–π fetch –¥–ª—è –∫–∞–∂–¥–æ–π!
    // ...
}
```

**–†–µ—à–µ–Ω–∏–µ**:
```swift
// ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï
request.relationshipKeyPathsForPrefetching = ["account", "targetAccount", "recurringSeries"]
```

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç**: –£–º–µ–Ω—å—à–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ 50-70%

---

### Performance Issue #3: –ò–∑–±—ã—Ç–æ—á–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `TransactionsViewModel`

```swift
private var cachedSummary: Summary?
private var summaryCacheInvalidated = true
private var cachedCategoryExpenses: [String: CategoryExpense]?
private var categoryExpensesCacheInvalidated = true
private var convertedAmountsCache: [String: Double] = [:]
private var conversionCacheInvalidated = true
```

**–ü—Ä–æ–±–ª–µ–º—ã**:
1. –ö—ç—à–∏ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ (–¥–∞–∂–µ –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–º)
2. –ù–µ—Ç granular invalidation
3. –ö—ç—à–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ (—É—Ç–µ—á–∫–∞ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –¥–∞–Ω–Ω—ã—Ö)

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å NSCache —Å memory pressure handling

---

### Performance Issue #4: –ü–µ—Ä–µ—Å—á–µ—Ç –±–∞–ª–∞–Ω—Å–æ–≤ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `TransactionsViewModel`

```swift
func addTransaction(...) {
    // ...
    recalculateAccountBalances()  // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç –í–°–ï —Å—á–µ—Ç–∞
    saveToStorage()
}
```

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ 1000 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –±–∞–ª–∞–Ω—Å—ã –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è 1000 —Ä–∞–∑

**–†–µ—à–µ–Ω–∏–µ**: Batch operations —Å –æ–¥–Ω–∏–º –ø–µ—Ä–µ—Å—á–µ—Ç–æ–º –≤ –∫–æ–Ω—Ü–µ

---

## –ë–∞–≥–∏ –ø—Ä–∏ CRUD –æ–ø–µ—Ä–∞—Ü–∏—è—Ö

### Bug #1: –£–¥–∞–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç –±–∞–ª–∞–Ω—Å

**–°—Ü–µ–Ω–∞—Ä–∏–π**:
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –Ω–∞ 1000‚Ç∏
2. –ë–∞–ª–∞–Ω—Å —Å—á–µ—Ç–∞: 10000 ‚Üí 11000
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª—è–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
4. ‚ùå –ë–∞–ª–∞–Ω—Å –æ—Å—Ç–∞–µ—Ç—Å—è 11000 (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 10000)
```

**–ü—Ä–∏—á–∏–Ω–∞**: –í –º–µ—Ç–æ–¥–µ `deleteTransaction` –Ω–µ –≤—Å–µ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `recalculateAccountBalances()`

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `TransactionsViewModel` (—Å—Ç—Ä–æ–∫–∞ ~1800)

---

### Bug #2: –ò–∑–º–µ–Ω–µ–Ω–∏–µ recurring transaction –Ω–µ —É–¥–∞–ª—è–µ—Ç –±—É–¥—É—â–∏–µ

**–°—Ü–µ–Ω–∞—Ä–∏–π**:
```
1. –°–æ–∑–¥–∞–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∞ Netflix –Ω–∞ 15 —á–∏—Å–ª–æ –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—è—Ü–∞
2. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–∞ 3 –º–µ—Å—è—Ü–∞ –≤–ø–µ—Ä–µ–¥
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–µ–Ω—è–µ—Ç –¥–∞—Ç—É –Ω–∞ 20 —á–∏—Å–ª–æ
4. ‚ùå –°—Ç–∞—Ä—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–Ω–∞ 15 —á–∏—Å–ª–æ) –æ—Å—Ç–∞—é—Ç—Å—è
```

**–ö–æ–¥ –ø—Ä–æ–±–ª–µ–º—ã**:
```swift
func updateRecurringSeries(_ series: RecurringSeries) {
    // ...
    let frequencyChanged = oldSeries.frequency != series.frequency
    let _ = oldSeries.startDate != series.startDate
    
    // Note: Deleting future transactions should be handled by TransactionsViewModel
    // ‚ùå –ù–û TransactionsViewModel –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏!
}
```

---

### Bug #3: –ò–º–ø–æ—Ä—Ç CSV –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã

**–°—Ü–µ–Ω–∞—Ä–∏–π**:
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç CSV —Ñ–∞–π–ª
2. –ò–º–ø–æ—Ä—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —á–µ—Ä–µ–∑ addTransactionsForImport()
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Ç–æ—Ç –∂–µ —Ñ–∞–π–ª —Å–Ω–æ–≤–∞
4. ‚ùå –î—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è
```

**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ (date, amount, description, accountId)

---

### Bug #4: Transfer —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –º–æ–∂–µ—Ç –∏–º–µ—Ç—å orphan targetAccount

**–°—Ü–µ–Ω–∞—Ä–∏–π**:
```
1. –°–æ–∑–¥–∞–Ω –ø–µ—Ä–µ–≤–æ–¥: –°—á–µ—Ç –ê ‚Üí –°—á–µ—Ç –ë
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª—è–µ—Ç –°—á–µ—Ç –ë
3. ‚ùå –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤—Å–µ –µ—â–µ —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Å—á–µ—Ç
4. ‚ùå –ü—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ - crash –∏–ª–∏ –ø—É—Å—Ç–æ–µ –º–µ—Å—Ç–æ
```

**–ü—Ä–∏—á–∏–Ω–∞**: Delete Rule –≤ Core Data = "Nullify", –Ω–æ ViewModel –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç orphan references

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∫–∞–∂–¥–æ–º—É ViewModel

### AccountsViewModel

#### ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã
- –ü—Ä–æ—Å—Ç–∞—è –∏ –ø–æ–Ω—è—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- –•–æ—Ä–æ—à–µ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ deposit –∏ regular accounts
- Intelligent account ranking —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ

#### ‚ùå –ü—Ä–æ–±–ª–µ–º—ã
1. **syncAccountBalances()** –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –∏–∑ —Ä–∞–∑–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤
2. **saveAllAccountsSync()** –±–ª–æ–∫–∏—Ä—É–µ—Ç Main Thread
3. –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ –≤—ã–∑–æ–≤—ã `objectWillChange.send()`

#### üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
```swift
// ‚ùå –ë–´–õ–û
accounts = newAccounts
objectWillChange.send()

// ‚úÖ –°–¢–ê–õ–û
accounts = newAccounts  // @Published –¥–µ–ª–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
```

```swift
// ‚ùå –ë–´–õ–û
func saveAllAccountsSync() {
    // –ù–∞ Main Thread
    try coreDataRepo.saveAccountsSync(accounts)
}

// ‚úÖ –°–¢–ê–õ–û
func saveAllAccounts() async throws {
    // –ù–∞ Background
    await repository.saveAccounts(accounts)
}
```

---

### TransactionsViewModel

#### ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã
- Comprehensive feature set
- –•–æ—Ä–æ—à–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

#### ‚ùå –ü—Ä–æ–±–ª–µ–º—ã
1. **–¢–û–û –ë–û–õ–¨–®–û–ô**: 2334 —Å—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞ ‚ùå
2. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ –ø–∞–º—è—Ç—å
3. Weak reference –Ω–∞ accountsViewModel –º–æ–∂–µ—Ç –±—ã—Ç—å nil
4. –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–µ–π (–Ω–∞—Ä—É—à–µ–Ω–∏–µ Single Responsibility)

#### üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

**1. –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ—Ä–≤–∏—Å–æ–≤:**
```
TransactionsViewModel (coordination)
  ‚îú‚îÄ‚îÄ TransactionCRUDService (create, read, update, delete)
  ‚îú‚îÄ‚îÄ TransactionFilteringService (filtering, grouping)
  ‚îú‚îÄ‚îÄ TransactionCacheService (caching, invalidation)
  ‚îú‚îÄ‚îÄ RecurringTransactionService (recurring logic)
  ‚îî‚îÄ‚îÄ BalanceCalculationService (account balance updates)
```

**2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å NSFetchedResultsController:**
```swift
// ‚úÖ –ü–†–ï–î–õ–û–ñ–ï–ù–ò–ï
class TransactionsViewModel: NSObject, NSFetchedResultsControllerDelegate {
    private lazy var fetchedResultsController: NSFetchedResultsController<TransactionEntity> = {
        let request = TransactionEntity.fetchRequest()
        request.sortDescriptors = [NSSortDescriptor(key: "date", ascending: false)]
        request.fetchBatchSize = 50
        
        let controller = NSFetchedResultsController(
            fetchRequest: request,
            managedObjectContext: CoreDataStack.shared.viewContext,
            sectionNameKeyPath: nil,
            cacheName: "TransactionsCache"
        )
        controller.delegate = self
        return controller
    }()
    
    var transactions: [Transaction] {
        return fetchedResultsController.fetchedObjects?.map { $0.toTransaction() } ?? []
    }
}
```

**3. –£–±—Ä–∞—Ç—å —Å–ª–∞–±—É—é —Å—Å—ã–ª–∫—É:**
```swift
// ‚ùå –ë–´–õ–û
weak var accountsViewModel: AccountsViewModel?

// ‚úÖ –°–¢–ê–õ–û (—á–µ—Ä–µ–∑ AppCoordinator –∏–ª–∏ DI)
let accountsViewModel: AccountsViewModel
```

---

### CategoriesViewModel

#### ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã
- –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π, –ø—Ä–∞–≤–∏–ª –∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π
- –•–æ—Ä–æ—à–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –±—é–¥–∂–µ—Ç–æ–≤
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

#### ‚ùå –ü—Ä–æ–±–ª–µ–º—ã
1. CategoryRule –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è –ø–æ description (–Ω–µ –ø–æ id)
2. –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ –≤—ã–∑–æ–≤—ã `objectWillChange.send()`
3. `saveCategoriesSync()` –±–ª–æ–∫–∏—Ä—É–µ—Ç UI

#### üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
```swift
// ‚ùå –ü–†–û–ë–õ–ï–ú–ê: CategoryRule –±–µ–∑ id
struct CategoryRule {
    let description: String  // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –∫–ª—é—á
    let category: String
    let isEnabled: Bool
}

// ‚úÖ –†–ï–®–ï–ù–ò–ï: –î–æ–±–∞–≤–∏—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
struct CategoryRule: Identifiable {
    let id: String
    let pattern: String  // –í–º–µ—Å—Ç–æ description
    let category: String
    let isEnabled: Bool
}
```

---

### SubscriptionsViewModel

#### ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã
- –•–æ—Ä–æ—à–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å notifications
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ lifecycle (active, paused, archived)
- –ß–∏—Å—Ç—ã–π API

#### ‚ùå –ü—Ä–æ–±–ª–µ–º—ã
1. **6 –º–µ—Å—Ç** —Å —Ä—É—á–Ω—ã–º `objectWillChange.send()` ‚ùå
2. Notification scheduling –≤ Task {} - –º–æ–∂–µ—Ç –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è
3. –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ permissions –¥–ª—è notifications

#### üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
```swift
// ‚ùå –ë–´–õ–û
recurringSeries = newSeries
objectWillChange.send()  // –ò–∑–±—ã—Ç–æ—á–Ω–æ

// ‚úÖ –°–¢–ê–õ–û
recurringSeries = newSeries  // @Published –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ
```

```swift
// ‚úÖ –î–û–ë–ê–í–ò–¢–¨: –ü—Ä–æ–≤–µ—Ä–∫–∞ permissions
func createSubscription(...) async -> RecurringSeries {
    let series = RecurringSeries(...)
    recurringSeries.append(series)
    repository.saveRecurringSeries(recurringSeries)
    
    // Check notification permissions
    let granted = await NotificationManager.requestPermission()
    if granted {
        await scheduleNotifications(for: series)
    }
    
    return series
}
```

---

### DepositsViewModel

#### ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã
- –°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π ViewModel (151 —Å—Ç—Ä–æ–∫–∞) ‚úÖ
- –î–µ–ª–µ–≥–∏—Ä—É–µ—Ç –±–æ–ª—å—à—É—é —á–∞—Å—Ç—å —Ä–∞–±–æ—Ç—ã –Ω–∞ AccountsViewModel
- –ß–µ—Ç–∫–∞—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å

#### ‚ùå –ü—Ä–æ–±–ª–µ–º—ã
1. `reconcileAllDeposits()` —Ç—Ä–µ–±—É–µ—Ç –≤—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (memory intensive)
2. –ü—Ä—è–º–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –Ω–∞ AccountsViewModel (—Ç–µ—Å–Ω–∞—è —Å–≤—è–∑—å)

#### üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
```swift
// ‚ùå –ë–´–õ–û
func reconcileAllDeposits(allTransactions: [Transaction], ...) {
    for account in accountsViewModel.accounts where account.isDeposit {
        // ...
    }
}

// ‚úÖ –°–¢–ê–õ–û: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å fetch request –≤–º–µ—Å—Ç–æ –º–∞—Å—Å–∏–≤–∞
func reconcileAllDeposits(onTransactionCreated: @escaping (Transaction) -> Void) async {
    let deposits = try await repository.fetchDeposits()
    
    for deposit in deposits {
        let transactions = try await repository.fetchTransactions(forAccount: deposit.id)
        // ...
    }
}
```

---

### AppCoordinator

#### ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ ‚úÖ
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤ –Ω—É–∂–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
- Migration handling

#### ‚ùå –ü—Ä–æ–±–ª–µ–º—ã
1. ViewModels –ø–æ–¥–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥—Ä—É–≥ –¥—Ä—É–≥–∞ —á–µ—Ä–µ–∑ `setupViewModelObservers()`
2. –≠—Ç–æ —Å–æ–∑–¥–∞–µ—Ç —Ü–µ–ø–æ—á–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (cascade updates)
3. –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ infinite loops

#### üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
```swift
// ‚ùå –¢–ï–ö–£–©–ò–ô –ü–û–î–•–û–î
private func setupViewModelObservers() {
    accountsViewModel.objectWillChange
        .sink { [weak self] _ in
            self?.objectWillChange.send()  // –ü—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ–º Views
        }
        .store(in: &cancellables)
    // ... —Ç–æ –∂–µ –¥–ª—è –≤—Å–µ—Ö ViewModels
}

// ‚úÖ –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ê: –ù–µ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
// –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ Views –¥–æ–ª–∂–Ω—ã —è–≤–Ω–æ –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –Ω–∞ –Ω—É–∂–Ω—ã–µ –∏–º ViewModels
// –≠—Ç–æ —É–º–µ–Ω—å—à–∏—Ç –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI
```

---

## –ü–ª–∞–Ω —É–ª—É—á—à–µ–Ω–∏–π

### –§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (1-2 –Ω–µ–¥–µ–ª–∏)

#### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: üî¥ –í–´–°–û–ö–ò–ô

**1.1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å Race Conditions**
- [ ] –°–æ–∑–¥–∞—Ç—å `SaveCoordinator` Actor –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π
- [ ] –û–±–µ—Ä–Ω—É—Ç—å –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ serial queue
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –Ω–∞ concurrent access

```swift
actor CoreDataSaveCoordinator {
    private let stack = CoreDataStack.shared
    
    func performSave<T>(_ operation: @escaping (NSManagedObjectContext) throws -> T) async throws -> T {
        let context = stack.newBackgroundContext()
        return try await context.perform {
            let result = try operation(context)
            if context.hasChanges {
                try context.save()
            }
            return result
        }
    }
}
```

**1.2. –£–±—Ä–∞—Ç—å —Ä—É—á–Ω—ã–µ objectWillChange.send()**
- [ ] –£–¥–∞–ª–∏—Ç—å –≤—Å–µ 13 –≤—ã–∑–æ–≤–æ–≤
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ UI –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –æ —Ç–æ–º, —á—Ç–æ @Published –¥–µ–ª–∞–µ—Ç —ç—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

**1.3. –î–æ–±–∞–≤–∏—Ç—å Unique Constraints –≤ Core Data**
- [ ] Transaction: unique(id)
- [ ] Account: unique(id)
- [ ] RecurringSeries: unique(id)
- [ ] Category: unique(id)

**1.4. –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å–ª–∞–±—É—é —Å—Å—ã–ª–∫—É –≤ TransactionsViewModel**
- [ ] –°–¥–µ–ª–∞—Ç—å —Å–∏–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É —á–µ—Ä–µ–∑ DI
- [ ] –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Protocol –¥–ª—è decoupling

---

### –§–∞–∑–∞ 2: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (2-3 –Ω–µ–¥–µ–ª–∏)

#### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: üü° –°–†–ï–î–ù–ò–ô

**2.1. Pagination –¥–ª—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**
- [ ] –í–Ω–µ–¥—Ä–∏—Ç—å NSFetchedResultsController
- [ ] –ó–∞–≥—Ä—É–∂–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±–∞—Ç—á–∞–º–∏ –ø–æ 50-100
- [ ] Infinite scroll –≤ UI

**2.2. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å fetch requests**
- [ ] –î–æ–±–∞–≤–∏—Ç—å `relationshipKeyPathsForPrefetching`
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `fetchBatchSize`
- [ ] –°–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã –≤ Core Data –Ω–∞ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ø–æ–ª—è—Ö

**2.3. –£–ª—É—á—à–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å NSCache –≤–º–µ—Å—Ç–æ Dictionary
- [ ] Granular cache invalidation (–Ω–µ –≤—Å–µ —Å—Ä–∞–∑—É)
- [ ] Cache expiration policies

**2.4. –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Ç—è–∂–µ–ª—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ background**
- [ ] `recalculateAccountBalances()` ‚Üí async
- [ ] `generateRecurringTransactions()` ‚Üí background queue
- [ ] CSV import ‚Üí background with progress reporting

---

### –§–∞–∑–∞ 3: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (3-4 –Ω–µ–¥–µ–ª–∏)

#### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: üü¢ –ù–ò–ó–ö–ò–ô (–Ω–æ –≤–∞–∂–Ω—ã–π –¥–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –∑–¥–æ—Ä–æ–≤—å—è –∫–æ–¥–∞)

**3.1. –†–∞–∑–¥–µ–ª–∏—Ç—å TransactionsViewModel**
```
TransactionsViewModel (2334 —Å—Ç—Ä–æ–∫–∏)
  ‚Üì
TransactionsCoordinator (200 —Å—Ç—Ä–æ–∫)
  ‚îú‚îÄ‚îÄ TransactionCRUDService (300 —Å—Ç—Ä–æ–∫)
  ‚îú‚îÄ‚îÄ TransactionFilterService (400 —Å—Ç—Ä–æ–∫)
  ‚îú‚îÄ‚îÄ RecurringTransactionService (500 —Å—Ç—Ä–æ–∫)
  ‚îú‚îÄ‚îÄ BalanceCalculationService (300 —Å—Ç—Ä–æ–∫)
  ‚îî‚îÄ‚îÄ TransactionCacheService (200 —Å—Ç—Ä–æ–∫)
```

**3.2. –í–Ω–µ–¥—Ä–∏—Ç—å Dependency Injection**
- [ ] –°–æ–∑–¥–∞—Ç—å DI Container
- [ ] –£–±—Ä–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ ViewModels –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Protocol-oriented approach

**3.3. –£–ª—É—á—à–∏—Ç—å Error Handling**
- [ ] –°–æ–∑–¥–∞—Ç—å `RepositoryError` enum
- [ ] –ü—Ä–æ–±—Ä–∞—Å—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –¥–æ UI
- [ ] –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

**3.4. –î–æ–±–∞–≤–∏—Ç—å Offline Support**
- [ ] –û—á–µ—Ä–µ–¥—å –æ–ø–µ—Ä–∞—Ü–∏–π –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Å–µ—Ç–∏
- [ ] Retry logic –¥–ª—è failed saves
- [ ] Conflict resolution –ø—Ä–∏ sync

---

### –§–∞–∑–∞ 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (1-2 –Ω–µ–¥–µ–ª–∏)

**4.1. Unit Tests**
- [ ] –¢–µ—Å—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ ViewModel (coverage > 80%)
- [ ] Mock Repository –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏
- [ ] –¢–µ—Å—Ç—ã –Ω–∞ edge cases

**4.2. Integration Tests**
- [ ] –¢–µ—Å—Ç—ã –Ω–∞ Core Data –æ–ø–µ—Ä–∞—Ü–∏–∏
- [ ] –¢–µ—Å—Ç—ã –Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö
- [ ] –¢–µ—Å—Ç—ã –Ω–∞ concurrent access

**4.3. Performance Tests**
- [ ] –ò–∑–º–µ—Ä–∏—Ç—å –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
- [ ] Benchmark CRUD –æ–ø–µ—Ä–∞—Ü–∏–π
- [ ] Memory profiling

**4.4. Crash Reporting**
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Crashlytics / Sentry
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ Core Data –æ—à–∏–±–æ–∫
- [ ] Analytics –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–±–ª–µ–º

---

## –ú–µ—Ç—Ä–∏–∫–∏ –∏ –æ—Ü–µ–Ω–∫–∏

### –¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ (baseline)

| –ú–µ—Ç—Ä–∏–∫–∞ | –¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ | –¶–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ |
|---------|------------------|------------------|
| **Startup time** | 800-1200ms | < 500ms |
| **Memory usage** (1000 txns) | 8-12 MB | < 5 MB |
| **Transaction load time** | 200-400ms | < 100ms |
| **Save operation time** | 100-300ms | < 50ms |
| **UI freeze –ø—Ä–∏ save** | 50-150ms | < 16ms (60 FPS) |
| **Race condition bugs** | 3-5 per month | 0 |
| **Data loss incidents** | 1-2 per month | 0 |

### –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –ø–æ—Å–ª–µ –§–∞–∑—ã 1

| –ú–µ—Ç—Ä–∏–∫–∞ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|-----------|
| Race conditions | -90% |
| Data loss | -100% |
| UI responsiveness | +30% |
| Crash rate | -60% |

### –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –ø–æ—Å–ª–µ –§–∞–∑—ã 2

| –ú–µ—Ç—Ä–∏–∫–∞ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|-----------|
| Memory usage | -50% |
| Load time | -60% |
| Scroll performance | +80% |
| Battery consumption | -20% |

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è (–≤—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ)

1. ‚úÖ **–ò—Å–ø—Ä–∞–≤–∏—Ç—å Race Conditions** - —ç—Ç–æ —Å–∞–º–∞—è –≤–∞–∂–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞
   - –î–æ–±–∞–≤–∏—Ç—å Actor –¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å serial queue –¥–ª—è Core Data –æ–ø–µ—Ä–∞—Ü–∏–π

2. ‚úÖ **–£–±—Ä–∞—Ç—å —Ä—É—á–Ω—ã–µ objectWillChange.send()**
   - –ü—Ä–æ—Å—Ç–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ, –±–æ–ª—å—à–æ–π —ç—Ñ—Ñ–µ–∫—Ç –Ω–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å UI

3. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å unique constraints**
   - –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

4. ‚úÖ **–ò—Å–ø—Ä–∞–≤–∏—Ç—å weak reference**
   - –£—Å—Ç—Ä–∞–Ω–∏—Ç silent failures –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –±–∞–ª–∞–Ω—Å–æ–≤

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —Ü–µ–ª–∏

1. **–ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: –†–∞–∑–¥–µ–ª–∏—Ç—å –±–æ–ª—å—à–∏–µ ViewModels –Ω–∞ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
2. **Pagination**: –ù–µ –∑–∞–≥—Ä—É–∂–∞—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ –ø–∞–º—è—Ç—å
3. **Offline-first**: –†–∞–±–æ—Ç–∞ –±–µ–∑ —Å–µ—Ç–∏ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏
4. **Comprehensive testing**: 80%+ code coverage

### –†–∏—Å–∫–∏

1. **–ò–∑–º–µ–Ω–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª** ‚Üí –ù—É–∂–Ω—ã —Ç–µ—Å—Ç—ã –ø–µ—Ä–µ–¥ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–æ–º
2. **–ú–∏–≥—Ä–∞—Ü–∏—è Core Data –º–æ–¥–µ–ª–∏** ‚Üí –ù—É–∂–µ–Ω migration plan
3. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ** ‚Üí –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ backup –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏

---

**–ö–æ–Ω–µ—Ü –æ—Ç—á–µ—Ç–∞**

_–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –ø–æ –º–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —É–ª—É—á—à–µ–Ω–∏–π._
