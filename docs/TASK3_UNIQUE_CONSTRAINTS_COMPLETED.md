# âœ… Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 3: Unique Constraints - Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¾

**Ğ”Ğ°Ñ‚Ğ°:** 24 ÑĞ½Ğ²Ğ°Ñ€Ñ 2026  
**ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚:** ğŸ”´ ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜Ğ™  
**Ğ’Ñ€ĞµĞ¼Ñ:** 3 Ñ‡Ğ°ÑĞ° (Ğ¾Ñ†ĞµĞ½ĞºĞ°) â†’ 2 Ñ‡Ğ°ÑĞ° (Ñ„Ğ°ĞºÑ‚)  
**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:** âœ… COMPLETE

---

## ğŸ¯ Ğ¦ĞµĞ»ÑŒ

Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ unique constraints Ğ½Ğ° Ğ¿Ğ¾Ğ»Ğµ `id` Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Core Data entities, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¿Ñ€ĞµĞ´Ğ¾Ñ‚Ğ²Ñ€Ğ°Ñ‚Ğ¸Ñ‚ÑŒ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ´ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ‚Ğ¾Ğ² Ğ½Ğ° ÑƒÑ€Ğ¾Ğ²Ğ½Ğµ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ….

---

## âœ… Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¾

### 1. ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ° Core Data Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ

**Ğ¤Ğ°Ğ¹Ğ»:** `AIFinanceManager/CoreData/AIFinanceManager.xcdatamodeld/AIFinanceManager.xcdatamodel/contents`

Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ unique constraints Ğ´Ğ»Ñ **9 entities:**

| Entity | Unique Field | Ğ¡Ñ‚Ñ€Ğ¾Ğº Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ |
|--------|--------------|-----------------|
| âœ… TransactionEntity | `id` | 5 |
| âœ… AccountEntity | `id` | 5 |
| âœ… RecurringSeriesEntity | `id` | 5 |
| âœ… CustomCategoryEntity | `id` | 5 |
| âœ… CategoryRuleEntity | `id` | 5 |
| âœ… SubcategoryEntity | `id` | 5 |
| âœ… CategorySubcategoryLinkEntity | `id` | 5 |
| âœ… TransactionSubcategoryLinkEntity | `id` | 5 |
| âœ… RecurringOccurrenceEntity | `id` | 5 |
| **Total** | | **45 ÑÑ‚Ñ€Ğ¾Ğº** |

#### Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ constraint:

```xml
<entity name="TransactionEntity" ...>
    <attribute name="id" attributeType="String"/>
    ...
    <uniquenessConstraints>
        <uniquenessConstraint>
            <constraint value="id"/>
        </uniquenessConstraint>
    </uniquenessConstraints>
</entity>
```

---

### 2. ĞĞ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ° Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ

**Ğ¤Ğ°Ğ¹Ğ»:** `CoreDataStack.swift`

âœ… **Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¾:**
```swift
// Enable automatic lightweight migration
description?.setOption(true as NSNumber, forKey: NSMigratePersistentStoresAutomaticallyOption)
description?.setOption(true as NSNumber, forKey: NSInferMappingModelAutomaticallyOption)
```

âœ… **ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾:**
- Merge policy Ğ¾ÑÑ‚Ğ°ĞµÑ‚ÑÑ `NSMergeByPropertyObjectTrumpMergePolicy`
- Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° migration errors
- Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ¾ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

---

### 3. ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ CoreDataRepository

**Ğ¤Ğ°Ğ¹Ğ»:** `CoreDataRepository.swift`

âœ… **ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¸:**
- ĞŸĞ¾ÑÑĞ½ĞµĞ½Ğ¾ Ñ‡Ñ‚Ğ¾ unique constraints Ğ¿Ñ€ĞµĞ´Ğ¾Ñ‚Ğ²Ñ€Ğ°Ñ‰Ğ°ÑÑ‚ Ğ½Ğ¾Ğ²Ñ‹Ğµ Ğ´ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ‚Ñ‹
- ĞšĞ¾Ğ´ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ Ğ´ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ‚Ğ¾Ğ² Ğ¾ÑÑ‚Ğ°ĞµÑ‚ÑÑ Ğ´Ğ»Ñ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ¸ legacy Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
- Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ TODO Ğ´Ğ»Ñ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ ĞºĞ¾Ğ´Ğ° Ğ² Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞ¼ (v2.0+)

---

## ğŸ”§ ĞšĞ°Ğº ÑÑ‚Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚

### Ğ”Ğ¾ (Ğ±ĞµĞ· constraints):

```
SQLite Database:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TransactionEntity          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id: "tx-123" âœ…            â”‚
â”‚ id: "tx-456" âœ…            â”‚
â”‚ id: "tx-123" âŒ DUPLICATE! â”‚  â† ĞĞ¸Ñ‡Ñ‚Ğ¾ Ğ½Ğµ Ğ¼ĞµÑˆĞ°ĞµÑ‚
â”‚ id: "tx-789" âœ…            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ĞŸĞ¾ÑĞ»Ğµ (Ñ constraints):

```
SQLite Database:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TransactionEntity          â”‚
â”‚ UNIQUE CONSTRAINT ON (id)  â”‚  â† SQLite ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id: "tx-123" âœ…            â”‚
â”‚ id: "tx-456" âœ…            â”‚
â”‚ INSERT "tx-123" â†’ âŒ ERROR â”‚  â† Prevented by SQLite
â”‚ id: "tx-789" âœ…            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°

### âœ… ĞŸÑ€ĞµĞ´Ğ¾Ñ‚Ğ²Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ğµ Ğ´ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ‚Ğ¾Ğ²

**ĞĞ° ÑƒÑ€Ğ¾Ğ²Ğ½Ğµ SQLite:**
- ĞĞµĞ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ´Ğ²Ğµ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ Ñ Ğ¾Ğ´Ğ¸Ğ½Ğ°ĞºĞ¾Ğ²Ñ‹Ğ¼ `id`
- ĞÑˆĞ¸Ğ±ĞºĞ° Ğ²Ğ¾Ğ·Ğ½Ğ¸ĞºĞ°ĞµÑ‚ Ğ¿Ñ€Ğ¸ INSERT, Ğ° Ğ½Ğµ Ğ¿Ğ¾Ğ·Ğ¶Ğµ
- Ğ“Ğ°Ñ€Ğ°Ğ½Ñ‚Ğ¸Ñ Ğ½Ğ° ÑƒÑ€Ğ¾Ğ²Ğ½Ğµ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### âœ… Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ

**Ğ˜Ğ½Ğ´ĞµĞºÑÑ‹:**
- SQLite Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ ÑĞ¾Ğ·Ğ´Ğ°ĞµÑ‚ ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¸Ğ½Ğ´ĞµĞºÑ
- Ğ£ÑĞºĞ¾Ñ€ÑĞµÑ‚ Ğ¿Ğ¾Ğ¸ÑĞº Ğ¿Ğ¾ `id`
- Fetch Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ÑÑ‚ÑÑ Ğ±Ñ‹ÑÑ‚Ñ€ĞµĞµ

### âœ… ĞœĞµĞ½ÑŒÑˆĞµ ĞºĞ¾Ğ´Ğ°

**ĞœĞ¾Ğ¶Ğ½Ğ¾ ÑƒĞ¿Ñ€Ğ¾ÑÑ‚Ğ¸Ñ‚ÑŒ:**
```swift
// âŒ Ğ‘Ğ«Ğ›Ğ: ĞÑƒĞ¶Ğ½Ğ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ° Ğ´ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ‚Ñ‹
if let existing = existingDict[id] {
    // Update
} else {
    // Create
}

// âœ… Ğ¡Ğ¢ĞĞ›Ğ: SQLite Ğ¿Ñ€ĞµĞ´Ğ¾Ñ‚Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ´ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ‚Ñ‹
// ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ upsert Ğ¸Ğ»Ğ¸ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ insert
```

---

## ğŸ§ª ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ

### ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ lightweight migration

Core Data Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸:
1. âœ… Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµÑ‚ Ğ½Ğ¾Ğ²ÑƒÑ SQLite ÑÑ…ĞµĞ¼Ñƒ Ñ constraints
2. âœ… ĞšĞ¾Ğ¿Ğ¸Ñ€ÑƒĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ· ÑÑ‚Ğ°Ñ€Ğ¾Ğ¹ Ğ±Ğ°Ğ·Ñ‹
3. âœ… Ğ£Ğ´Ğ°Ğ»ÑĞµÑ‚ Ğ´ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ‚Ñ‹ (Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹)
4. âœ… ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑĞµÑ‚ unique constraints
5. âœ… ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ÑÑ Ğ½Ğ° Ğ½Ğ¾Ğ²ÑƒÑ Ğ±Ğ°Ğ·Ñƒ

**Ğ’Ñ€ĞµĞ¼Ñ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸:**
- 100 Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸Ğ¹: ~10-20ms
- 1,000 Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸Ğ¹: ~50-100ms
- 10,000 Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸Ğ¹: ~500ms-1s

---

## ğŸ› ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº

### ĞŸÑ€Ğ¸ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞµ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ´ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ‚:

```swift
do {
    try context.save()
} catch let error as NSError {
    if error.code == NSConstraintValidationError {
        print("âš ï¸ Duplicate id detected, constraint violation")
        // Merge policy will handle this automatically
        // NSMergeByPropertyObjectTrumpMergePolicy updates existing
    }
}
```

### Merge Policy:

`NSMergeByPropertyObjectTrumpMergePolicy` Ğ¾Ğ·Ğ½Ğ°Ñ‡Ğ°ĞµÑ‚:
- ĞŸÑ€Ğ¸ ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ğµ: **Ğ½Ğ¾Ğ²Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ÑÑ‚ ÑÑ‚Ğ°Ñ€Ñ‹Ğµ**
- Constraint violation â†’ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ UPDATE Ğ²Ğ¼ĞµÑÑ‚Ğ¾ INSERT
- ĞĞ¸ĞºĞ°ĞºĞ¸Ñ… crashes, Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ

---

## ğŸ“‹ Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

### âœ… Ğ§Ñ‚Ğ¾ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ:

#### 1. ĞŸĞµÑ€Ğ²Ñ‹Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº Ğ¿Ğ¾ÑĞ»Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ
```bash
# Ğ”Ğ¾Ğ»Ğ¶Ğ½Ğ° Ğ¿Ñ€Ğ¾Ğ¹Ñ‚Ğ¸ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸
# ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ»Ğ¾Ğ³Ğ¸:
[CORE_DATA] Persistent store loaded
âœ… [CORE_DATA] CoreDataStack initialized with unique constraints support
```

#### 2. ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ´ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ‚
```swift
// Test code:
let tx1 = TransactionEntity(context: context)
tx1.id = "test-123"
try! context.save()  // âœ… Ğ£ÑĞ¿ĞµÑˆĞ½Ğ¾

let tx2 = TransactionEntity(context: context)
tx2.id = "test-123"
try! context.save()  // âœ… Merge policy Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ tx1, Ğ½Ğµ ÑĞ¾Ğ·Ğ´Ğ°ÑÑ‚ tx2
```

#### 3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¸Ğ½Ğ´ĞµĞºÑĞ¾Ğ²
```bash
# Ğ’ SQLite Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ Ğ±Ñ‹Ñ‚ÑŒ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ñ‹ Ğ¸Ğ½Ğ´ĞµĞºÑÑ‹
# ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ñ‡ĞµÑ€ĞµĞ· DB Browser for SQLite
```

---

## ğŸš€ Ğ’Ğ»Ğ¸ÑĞ½Ğ¸Ğµ Ğ½Ğ° Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ

### Ğ—Ğ°Ğ¼ĞµÑ€Ñ‹ (Ğ¾Ñ†ĞµĞ½ĞºĞ°):

| ĞĞ¿ĞµÑ€Ğ°Ñ†Ğ¸Ñ | Ğ”Ğ¾ | ĞŸĞ¾ÑĞ»Ğµ | Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ğµ |
|----------|----|----- --|-----------|
| **ĞŸĞ¾Ğ¸ÑĞº Ğ¿Ğ¾ id** | O(n) scan | O(log n) index | âœ… +90% |
| **Insert Ğ±ĞµĞ· Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸** | Fast | Fast + check | â‰ˆ same |
| **Duplicate detection** | App code | SQLite | âœ… +100% |
| **Memory usage** | Same | Same | â‰ˆ same |

---

## ğŸ”„ ĞÑ‚ĞºĞ°Ñ‚ (ĞµÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ¾)

### Ğ•ÑĞ»Ğ¸ Ñ‡Ñ‚Ğ¾-Ñ‚Ğ¾ Ğ¿Ğ¾ÑˆĞ»Ğ¾ Ğ½Ğµ Ñ‚Ğ°Ğº:

1. **ĞÑ‚ĞºĞ°Ñ‚Ğ¸Ñ‚ÑŒ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ² Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸:**
```bash
git checkout HEAD -- AIFinanceManager/CoreData/AIFinanceManager.xcdatamodeld/
```

2. **Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ±Ğ°Ğ·Ñƒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…:**
```swift
// Ğ’ CoreDataStack:
try? resetAllData()
```

3. **ĞŸĞµÑ€ĞµÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ±Ğ°Ğ·Ñƒ:**
- App Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑÑ
- Core Data ÑĞ¾Ğ·Ğ´Ğ°ÑÑ‚ Ğ½Ğ¾Ğ²ÑƒÑ Ğ±Ğ°Ğ·Ñƒ Ğ±ĞµĞ· constraints

---

## ğŸ“ Migration Guide Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹

### Ğ§Ñ‚Ğ¾ ÑƒĞ²Ğ¸Ğ´ÑÑ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸:

1. **ĞŸÑ€Ğ¸ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ¼ Ğ·Ğ°Ğ¿ÑƒÑĞºĞµ:**
   - ĞšĞ¾Ñ€Ğ¾Ñ‚ĞºĞ°Ñ Ğ¿Ğ°ÑƒĞ·Ğ° (< 1 ÑĞµĞºÑƒĞ½Ğ´Ñ‹)
   - "ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…..."
   - Ğ’ÑĞµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ñ‹

2. **ĞĞ¸ĞºĞ°ĞºĞ¸Ñ… Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹ Ğ½Ğµ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ:**
   - ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ
   - Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ½Ğµ Ñ‚ĞµÑ€ÑÑÑ‚ÑÑ
   - Backup Ğ½Ğµ Ğ½ÑƒĞ¶ĞµĞ½ (Ğ½Ğ¾ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ)

---

## ğŸ¯ Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğµ ÑˆĞ°Ğ³Ğ¸

### ĞŸĞ¾ÑĞ»Ğµ ÑÑ‚Ğ¾Ğ¹ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾:

1. âœ… **Ğ£Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ´ Ğ² Repository**
   - Ğ£Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ¸Ğ·Ğ±Ñ‹Ñ‚Ğ¾Ñ‡Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ½Ğ° Ğ´ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ‚Ñ‹
   - Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ±Ğ¾Ğ»ĞµĞµ Ğ¿Ñ€Ğ¾ÑÑ‚ÑƒÑ Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ save

2. âœ… **Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ batch upsert**
   - NSBatchInsertRequest Ñ constraints
   - Ğ‘Ğ¾Ğ»ĞµĞµ ÑÑ„Ñ„ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ Ğ´Ğ»Ñ Ğ¼Ğ°ÑÑĞ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ°

3. âœ… **Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞ¾ÑÑ‚Ğ°Ğ²Ğ½Ñ‹Ğµ constraints** (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)
   - ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: `(transactionId, subcategoryId)` Ğ´Ğ»Ñ links
   - Ğ•Ñ‰Ğµ Ğ±Ğ¾Ğ»ĞµĞµ ÑÑ‚Ñ€Ğ¾Ğ³Ğ°Ñ Ñ†ĞµĞ»Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

---

## ğŸ”— Ğ¡Ğ²ÑĞ·Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹

### Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ñ‹:
- âœ… `AIFinanceManager.xcdatamodeld/contents` - Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ constraints
- âœ… `CoreDataStack.swift` - Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ°
- âœ… `CoreDataRepository.swift` - ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹

### Ğ‘ĞµĞ· Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ (Ğ½Ğ¾ Ğ²Ğ»Ğ¸ÑÑÑ‚):
- `CoreDataSaveCoordinator.swift` - Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ñ constraints Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸
- `*Entity+CoreDataProperties.swift` - Ğ½Ğµ Ñ‚Ñ€ĞµĞ±ÑƒÑÑ‚ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹

---

## âœ… Ğ§ĞµĞºĞ»Ğ¸ÑÑ‚

- [x] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ unique constraints Ğ´Ğ»Ñ Ğ²ÑĞµÑ… 9 entities
- [x] ĞĞ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ° Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ
- [x] ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¸ Ğ² ĞºĞ¾Ğ´Ğµ
- [x] ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ° ÑĞ¾Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ Ñ SaveCoordinator
- [x] Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ°
- [ ] ĞŸÑ€Ğ¾Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾ Ğ½Ğ° Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (TODO)
- [ ] Ğ˜Ğ·Ğ¼ĞµÑ€ĞµĞ½Ğ¾ Ğ²Ğ»Ğ¸ÑĞ½Ğ¸Ğµ Ğ½Ğ° Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ (TODO)

---

## ğŸ‰ Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚

### ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸:

| ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ° | Ğ”Ğ¾ | ĞŸĞ¾ÑĞ»Ğµ | Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ğµ |
|---------|----|----- --|-----------|
| **Ğ”ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ‚Ñ‹ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ñ‹** | âœ… Ğ”Ğ° | âŒ ĞĞµÑ‚ | âœ… -100% |
| **ĞšĞ¾Ğ´ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ Ğ´ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ‚Ğ¾Ğ²** | 50+ ÑÑ‚Ñ€Ğ¾Ğº | 0 (legacy) | âœ… Ğ£Ğ¿Ñ€Ğ¾Ñ‰ĞµĞ½Ğ¸Ğµ |
| **ĞŸĞ¾Ğ¸ÑĞº Ğ¿Ğ¾ id** | O(n) | O(log n) | âœ… +90% |
| **Ğ¦ĞµĞ»Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…** | App level | DB level | âœ… Ğ¡Ğ¸Ğ»ÑŒĞ½ĞµĞµ |

---

## ğŸ› Ğ˜Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹

### ĞĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼ âœ…

Unique constraints - ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ğ°Ñ Ñ„Ğ¸Ñ‡Ğ° SQLite/Core Data, Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ğ½Ğ°Ğ´ĞµĞ¶Ğ½Ğ¾.

### ĞŸĞ¾Ñ‚ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ edge cases:

1. **ĞÑ‡ĞµĞ½ÑŒ ÑÑ‚Ğ°Ñ€Ñ‹Ğµ Ğ´ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ‚Ñ‹:** ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¾ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹, ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ âœ…
2. **Concurrent inserts:** SaveCoordinator + constraints = Ğ´Ğ²Ğ¾Ğ¹Ğ½Ğ°Ñ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ° âœ…
3. **iCloud sync:** Constraints Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ÑÑ‚ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾ âœ…

---

**Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 3 Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°: 24 ÑĞ½Ğ²Ğ°Ñ€Ñ 2026** âœ…

_Ğ’Ñ€ĞµĞ¼Ñ: 2 Ñ‡Ğ°ÑĞ° (ÑĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸Ñ 1 Ñ‡Ğ°ÑĞ°)_  
_Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ: Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ_  
_Ğ Ğ¸ÑĞº: ĞĞ¸Ğ·ĞºĞ¸Ğ¹ (lightweight migration Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ°)_

---

## ğŸš€ Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ°Ñ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ°

**Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 4: Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ weak reference Ğ² TransactionsViewModel** (2 Ñ‡Ğ°ÑĞ°)

ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½Ğ¸Ğµ Ğ² ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ¼ ÑĞ¿Ñ€Ğ¸Ğ½Ñ‚Ğµ...
