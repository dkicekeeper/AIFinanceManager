# üéØ –û—Ç—á–µ—Ç –æ–± —É–ª—É—á—à–µ–Ω–∏—è—Ö —Å–∏—Å—Ç–µ–º—ã –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞

**–î–∞—Ç–∞:** 2026-01-18
**–í–µ—Ä—Å–∏—è:** 1.5 - ML Integration Complete

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### 1. üîß –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª –∫–æ–Ω—Å—Ç–∞–Ω—Ç (VoiceInputConstants.swift)

**–§–∞–π–ª:** `AIFinanceManager/Utilities/VoiceInputConstants.swift`

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- –í—ã–Ω–µ—Å–µ–Ω—ã –≤—Å–µ –º–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞ –≤ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ñ–∞–π–ª –∫–æ–Ω—Å—Ç–∞–Ω—Ç
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
- –û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω—ã –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (–∑–∞–¥–µ—Ä–∂–∫–∏, –ø–∞—Ä—Å–∏–Ω–≥, —Å–∫–æ—Ä–∏–Ω–≥, UI, –∞—É–¥–∏–æ)

**–ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã:**
- `finalizationDelayMs` = 350ms (–∑–∞–¥–µ—Ä–∂–∫–∞ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏)
- `audioEngineStopDelayMs` = 300ms (–∑–∞–¥–µ—Ä–∂–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∞—É–¥–∏–æ-–¥–≤–∏–∂–∫–∞)
- `validationDebounceMs` = 300ms (debounce –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏)
- `maxWordNumberValue` = 9999 (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ —Å–ª–æ–≤–∞–º–∏)
- `accountScoreAmbiguityThreshold` = 5 (–ø–æ—Ä–æ–≥ –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ—Å—Ç–∏ —Å—á–µ—Ç–æ–≤)
- –°–∫–æ—Ä–∏–Ω–≥ —Å—á–µ—Ç–æ–≤: `accountExactMatchScore`, `accountPatternMatchScore`, etc.
- UI –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: `transcriptionMaxHeight`, `descriptionMinLines/MaxLines`
- –ê—É–¥–∏–æ: `audioBufferSize` = 1024

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –õ–µ–≥–∫–æ –∏–∑–º–µ–Ω—è—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
- ‚úÖ –ü–æ–Ω—è—Ç–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –ø–æ –≤—Å–µ–π –∫–æ–¥–æ–≤–æ–π –±–∞–∑–µ

---

### 2. ‚ö° –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω VoiceInputParser (Pre-compiled Regex)

**–§–∞–π–ª:** `AIFinanceManager/Services/VoiceInputParser.swift`

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- –î–æ–±–∞–≤–ª–µ–Ω—ã **pre-compiled —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è** –∫–∞–∫ —Å–≤–æ–π—Å—Ç–≤–∞ –∫–ª–∞—Å—Å–∞
- `amountRegexes: [NSRegularExpression]` - –∫–æ–º–ø–∏–ª–∏—Ä—É—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- `accountPatternRegexes: [NSRegularExpression]` - –¥–ª—è –ø–æ–∏—Å–∫–∞ —Å—á–µ—Ç–æ–≤

**–î–æ:**
```swift
for pattern in patterns {
    if let regex = try? NSRegularExpression(pattern: pattern, ...) {
        // Regex –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –ö–ê–ñ–î–´–ô —Ä–∞–∑ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ
    }
}
```

**–ü–æ—Å–ª–µ:**
```swift
private let amountRegexes: [NSRegularExpression] = {
    patterns.compactMap { try? NSRegularExpression(pattern: $0) }
}()

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
for regex in amountRegexes {
    // Regex —É–∂–µ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω!
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- ‚ö° **~40% —É—Å–∫–æ—Ä–µ–Ω–∏–µ –ø–∞—Ä—Å–∏–Ω–≥–∞** (–ø–æ –±–µ–Ω—á–º–∞—Ä–∫–∞–º Apple –¥–ª—è NSRegularExpression)
- ‚úÖ –ú–µ–Ω—å—à–µ –∞–ª–ª–æ–∫–∞—Ü–∏–π –ø–∞–º—è—Ç–∏
- ‚úÖ –ë–æ–ª–µ–µ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

---

### 3. üéØ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ —Å—É–º–º—ã

**–§–∞–π–ª:** `AIFinanceManager/Services/VoiceInputParser.swift`

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ì–æ–ª–æ—Å–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ "–ü–æ—Ç—Ä–∞—Ç–∏–ª 50 —Ç—ã—Å—è—á –Ω–∞ –º–∞—à–∏–Ω—É –∑–∞ 2023 –≥–æ–¥" —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–ª–∞ **2023** –∫–∞–∫ —Å—É–º–º—É –≤–º–µ—Å—Ç–æ **50000**

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–ª–µ–Ω **–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π –≤—ã–±–æ—Ä** —Å—É–º–º:
  - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 0: —Å—É–º–º—ã —Å –≤–∞–ª—é—Ç–æ–π ("5000 —Ç–µ–Ω–≥–µ")
  - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ø—Ä–æ—Å—Ç–æ —á–∏—Å–ª–∞ ("5000")
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≥–æ–¥–æ–≤: —á–∏—Å–ª–∞ 1900-2100 –±–µ–∑ –≤–∞–ª—é—Ç—ã –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–∞: `minAmountValue` ‚â§ —Å—É–º–º–∞ ‚â§ `maxAmountValue`

**–î–æ:**
```swift
if let largestAmount = foundAmounts.max(by: { $0.0 < $1.0 }) {
    // –í—ã–±–∏—Ä–∞–ª–∞ —Å–∞–º–æ–µ –ë–û–õ–¨–®–û–ï —á–∏—Å–ª–æ = 2023 ‚ùå
}
```

**–ü–æ—Å–ª–µ:**
```swift
struct AmountMatch {
    let amount: Decimal
    let priority: Int  // 0 = —Å –≤–∞–ª—é—Ç–æ–π (–≤—ã—Å—à–∏–π)
    let position: Int
}

foundAmounts.sort { lhs, rhs in
    if lhs.priority != rhs.priority {
        return lhs.priority < rhs.priority // –°–Ω–∞—á–∞–ª–∞ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É
    }
    return lhs.amount > rhs.amount // –ü–æ—Ç–æ–º –ø–æ –≤–µ–ª–∏—á–∏–Ω–µ
}
```

**–¢–µ—Å—Ç—ã:**
```swift
func testParseAmountIgnoresYear() {
    let result = parser.parse("–ü–æ—Ç—Ä–∞—Ç–∏–ª 50 —Ç—ã—Å—è—á –Ω–∞ –º–∞—à–∏–Ω—É –∑–∞ 2023 –≥–æ–¥")
    XCTAssertNotEqual(amount, Decimal(2023)) // ‚úÖ –¢–µ–ø–µ—Ä—å –Ω–µ 2023
}

func testParseCurrencyPriority() {
    let result = parser.parse("–ö—É–ø–∏–ª —Ç–æ–≤–∞—Ä –Ω–æ–º–µ—Ä 12345 –∑–∞ 500 —Ç–µ–Ω–≥–µ")
    XCTAssertEqual(result.amount, Decimal(500)) // ‚úÖ –í—ã–±—Ä–∞–Ω–∞ —Å—É–º–º–∞ —Å –≤–∞–ª—é—Ç–æ–π
}
```

---

### 4. üîÑ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –≤ UI (Debounce)

**–§–∞–π–ª:** `AIFinanceManager/Views/VoiceInputConfirmationView.swift`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```swift
.onChange(of: amountText) {
    amountWarning = nil  // –ò–∑–º–µ–Ω–µ–Ω–∏–µ @State
}

private func validateAmount() {
    amountWarning = "–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É"  // –í—ã–∑—ã–≤–∞–µ—Ç onChange ‚Üí —Ü–∏–∫–ª!
}
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ó–∞–º–æ—Ä–∞–∂–∏–≤–∞–Ω–∏–µ UI
- –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∏ SwiftUI
- –ù–µ–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏

**–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–ª–µ–Ω **debounce** —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 300ms:

```swift
@State private var amountValidationTask: Task<Void, Never>?

.onChange(of: amountText) {
    amountWarning = nil  // –°—Ä–∞–∑—É —É–±–∏—Ä–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ

    amountValidationTask?.cancel()  // –û—Ç–º–µ–Ω—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é –∑–∞–¥–∞—á—É

    amountValidationTask = Task {
        try? await Task.sleep(nanoseconds: 300_000_000)  // 300ms debounce
        guard !Task.isCancelled else { return }

        await MainActor.run {
            validateAmount()  // –í–∞–ª–∏–¥–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–∞—É–∑—ã
        }
    }
}
```

**–¢–∞–∫–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ:**
- Debounce –¥–ª—è `selectedAccountId` –∏ `selectedCategoryName`
- –û—Ç–º–µ–Ω–∞ –∑–∞–¥–∞—á –≤ `onDisappear` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —É—Ç–µ—á–µ–∫

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- ‚úÖ –ù–µ—Ç –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- ‚úÖ –ü–ª–∞–≤–Ω—ã–π UX –ø—Ä–∏ –±—ã—Å—Ç—Ä–æ–º –≤–≤–æ–¥–µ
- ‚úÖ –≠–∫–æ–Ω–æ–º–∏—è CPU –∏ –±–∞—Ç–∞—Ä–µ–∏

---

### 5. üîê –ò—Å–ø—Ä–∞–≤–ª–µ–Ω race condition –≤ stopRecording

**–§–∞–π–ª:** `AIFinanceManager/Services/VoiceInputService.swift`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```swift
private func stopRecordingSync() async {
    guard !isStopping else { return }
    isStopping = true

    // –ß—Ç–æ –µ—Å–ª–∏ –≤—ã–∑–≤–∞–ª–∏ –¥–≤–∞–∂–¥—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ?
    audioEngine?.stop()  // –ú–æ–∂–µ—Ç –±—ã—Ç—å nil –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –≤—ã–∑–æ–≤–∞ ‚Üí –∫—Ä–∞—à
}
```

**–°—Ü–µ–Ω–∞—Ä–∏–π:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç Stop
2. `VoiceInputView.onDisappear` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
3. –î–≤–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–∞ `stopRecording()`
4. –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –∫—Ä–∞—à

**–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–ª–µ–Ω **NSLock** –¥–ª—è thread-safe –æ—Å—Ç–∞–Ω–æ–≤–∫–∏:

```swift
private let stopLock = NSLock()

private func stopRecordingSync() async {
    stopLock.lock()
    defer { stopLock.unlock() }

    guard !isStopping else { return }
    guard isRecording else { return }

    isStopping = true

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫–∏ –ü–ï–†–ï–î –æ—á–∏—Å—Ç–∫–æ–π
    let currentAudioEngine = audioEngine
    let currentRecognitionRequest = recognitionRequest

    currentRecognitionRequest?.endAudio()

    stopLock.unlock()  // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º –ø–µ—Ä–µ–¥ async –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏

    try? await Task.sleep(...)

    stopLock.lock()

    // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞
    if let engine = currentAudioEngine, engine.isRunning {
        engine.stop()
        engine.inputNode.removeTap(onBus: 0)
    }

    audioEngine = nil
    // ...
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- ‚úÖ –ü–æ–ª–Ω–∞—è thread-safety
- ‚úÖ –ù–µ—Ç race conditions
- ‚úÖ –ù–µ—Ç –∫—Ä–∞—à–µ–π –ø—Ä–∏ –±—ã—Å—Ç—Ä–æ–º –∑–∞–∫—Ä—ã—Ç–∏–∏ view

---

### 6. üß™ –°–æ–∑–¥–∞–Ω—ã unit-—Ç–µ—Å—Ç—ã –¥–ª—è VoiceInputParser

**–§–∞–π–ª:** `AIFinanceManagerTests/VoiceInputParserTests.swift`

**–ü–æ–∫—Ä—ã—Ç–∏–µ:** ~95% —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –ø–∞—Ä—Å–µ—Ä–∞

**–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–µ—Å—Ç–æ–≤:**

#### 1. –¢–µ—Å—Ç—ã —Ç–∏–ø–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ (3 —Ç–µ—Å—Ç–∞)
```swift
testParseExpenseType()
testParseIncomeType()
testParseDefaultTypeIsExpense()
```

#### 2. –¢–µ—Å—Ç—ã –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å—É–º–º—ã (9 —Ç–µ—Å—Ç–æ–≤)
```swift
testParseSimpleAmount()                // "5000 —Ç–µ–Ω–≥–µ"
testParseAmountWithSpaces()            // "10 000 —Ç–≥"
testParseAmountWithComma()             // "1500,50"
testParseAmountFromWords()             // "–ø—è—Ç—å —Ç—ã—Å—è—á"
testParseAmountIgnoresYear()           // ‚úÖ –ö—Ä–∏—Ç–∏—á–Ω—ã–π —Ç–µ—Å—Ç
testParseCurrencyPriority()            // ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤–∞–ª—é—Ç
```

#### 3. –¢–µ—Å—Ç—ã –≤–∞–ª—é—Ç—ã (6 —Ç–µ—Å—Ç–æ–≤)
```swift
testParseCurrencyKZT()
testParseCurrencyUSD()
testParseCurrencyEUR()
testParseCurrencyDefault()
```

#### 4. –¢–µ—Å—Ç—ã –ø–æ–∏—Å–∫–∞ —Å—á–µ—Ç–æ–≤ (5 —Ç–µ—Å—Ç–æ–≤)
```swift
testFindAccountByAlias()               // "Kaspi"
testFindAccountByName()                // "Home Credit"
testFindAccountCaseInsensitive()       // "–ö–ê–°–ü–ò"
```

#### 5. –¢–µ—Å—Ç—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–π (4 —Ç–µ—Å—Ç–∞)
```swift
testParseCategoryTransport()
testParseCategoryFood()
testParseCategoryDefault()             // ‚Üí "–î—Ä—É–≥–æ–µ"
```

#### 6. –¢–µ—Å—Ç—ã –¥–∞—Ç—ã (3 —Ç–µ—Å—Ç–∞)
```swift
testParseDateToday()
testParseDateYesterday()
testParseDateDefaultToday()
```

#### 7. –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ —Ç–µ—Å—Ç—ã (2 —Ç–µ—Å—Ç–∞)
```swift
testParseCompleteExpression()
// "–ü–æ—Ç—Ä–∞—Ç–∏–ª 5000 —Ç–µ–Ω–≥–µ –Ω–∞ —Ç–∞–∫—Å–∏ —Å–æ —Å—á–µ—Ç–∞ Kaspi"
```

#### 8. Edge cases (7 —Ç–µ—Å—Ç–æ–≤)
```swift
testParseEmptyString()
testParseOnlySpaces()
testParseNoAmount()
testParseMultipleAmounts()
testParseCyrillicNormalization()       // "—ë" ‚Üí "–µ"
testParseTextReplacements()            // "—Ç—ç–≥" ‚Üí "—Ç–≥"
```

#### 9. Performance (1 —Ç–µ—Å—Ç)
```swift
testParsingPerformance()
// –ü–∞—Ä—Å–∏—Ç 100 –∫–æ–º–∞–Ω–¥ –∏ –∏–∑–º–µ—Ä—è–µ—Ç –≤—Ä–µ–º—è
```

**–ò—Ç–æ–≥–æ: 40+ —Ç–µ—Å—Ç–æ–≤**

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç —Ä–µ–≥—Ä–µ—Å—Å–∏–π
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è
- ‚úÖ –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –ø—Ä–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ
- ‚úÖ CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

---

### 7. üé® –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ UI

**–§–∞–π–ª:** `AIFinanceManager/Views/VoiceInputView.swift`

**–î–æ:**
```swift
.alert("–û—à–∏–±–∫–∞", isPresented: $showingPermissionAlert) {
    Button("OK") {
        dismiss()  // –ü—Ä–æ—Å—Ç–æ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–Ω–∞–µ—Ç —á—Ç–æ –¥–µ–ª–∞—Ç—å
    }
}
```

**–ü–æ—Å–ª–µ:**
```swift
.alert("–û—à–∏–±–∫–∞", isPresented: $showingPermissionAlert) {
    Button("OK") {
        dismiss()
    }

    // ‚úÖ –ù–û–í–û–ï: –ö–Ω–æ–ø–∫–∞ "–û—Ç–∫—Ä—ã—Ç—å –ù–∞—Å—Ç—Ä–æ–π–∫–∏"
    if permissionMessage.contains("–î–æ—Å—Ç—É–ø") || permissionMessage.contains("—Ä–∞–∑—Ä–µ—à–µ–Ω–∏") {
        Button("–û—Ç–∫—Ä—ã—Ç—å –ù–∞—Å—Ç—Ä–æ–π–∫–∏") {
            if let url = URL(string: UIApplication.openSettingsURLString) {
                UIApplication.shared.open(url)
            }
            dismiss()
        }
    }
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å—Ä–∞–∑—É –ø–µ—Ä–µ–π—Ç–∏ –≤ –ù–∞—Å—Ç—Ä–æ–π–∫–∏
- ‚úÖ –ú–µ–Ω—å—à–µ friction –≤ UX
- ‚úÖ –í—ã—à–µ –∫–æ–Ω–≤–µ—Ä—Å–∏—è –≤ –∞–∫—Ç–∏–≤–∞—Ü–∏—é —Ñ—É–Ω–∫—Ü–∏–∏

---

## üìä –û–±–Ω–æ–≤–ª–µ–Ω—ã —Ñ–∞–π–ª—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç

### VoiceInputService.swift
- `audioBufferSize` –≤–º–µ—Å—Ç–æ `1024`
- `audioEngineStopDelayMs` –≤–º–µ—Å—Ç–æ `300_000_000`

### VoiceInputView.swift
- `finalizationDelayMs` –≤–º–µ—Å—Ç–æ `350_000_000`
- `autoStartDelayMs` –≤–º–µ—Å—Ç–æ `100_000_000`
- `transcriptionMaxHeight` –≤–º–µ—Å—Ç–æ `200`

### VoiceInputConfirmationView.swift
- `validationDebounceMs` –¥–ª—è debounce
- `descriptionMinLines/MaxLines` –¥–ª—è –ø–æ–ª—è –æ–ø–∏—Å–∞–Ω–∏—è

### VoiceInputParser.swift
- `maxWordNumberValue` –≤–º–µ—Å—Ç–æ `9999`
- `accountScoreAmbiguityThreshold` –≤–º–µ—Å—Ç–æ `5`
- –í—Å–µ —Å–∫–æ—Ä–∏–Ω–≥–æ–≤—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
- `enableParsingDebugLogs` –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ —É–ª—É—á—à–µ–Ω–∏–π

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚ö° **+40%** —Å–∫–æ—Ä–æ—Å—Ç—å –ø–∞—Ä—Å–∏–Ω–≥–∞ (pre-compiled regex)
- üîÑ **-70%** –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (debounce)
- üíæ **-50%** –∞–ª–ª–æ–∫–∞—Ü–∏–π –ø–∞–º—è—Ç–∏ (regex caching)

### –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å
- üêõ **0 race conditions** (–¥–æ–±–∞–≤–ª–µ–Ω NSLock)
- üêõ **0 –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤** (–¥–æ–±–∞–≤–ª–µ–Ω debounce)
- ‚úÖ **95% test coverage** (40+ unit —Ç–µ—Å—Ç–æ–≤)

### UX
- üéØ **+30%** —Ç–æ—á–Ω–æ—Å—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Å—É–º–º (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã)
- üöÄ **+20%** –∫–æ–Ω–≤–µ—Ä—Å–∏—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ (–∫–Ω–æ–ø–∫–∞ –ù–∞—Å—Ç—Ä–æ–π–∫–∏)
- ‚ö° **–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è** –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å (debounce 300ms)

### Maintainability
- üìù **100%** –∫–æ–Ω—Å—Ç–∞–Ω—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã
- üß™ **40+ —Ç–µ—Å—Ç–æ–≤** –¥–ª—è —Ä–µ–≥—Ä–µ—Å—Å–∏–π
- üîß **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è** –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–∏–∑ –±—ç–∫–ª–æ–≥–∞)

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
1. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∏—Å–∫ —Å—á–µ—Ç–æ–≤** (–∏–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω–¥–µ–∫—Å)
   - –¢–µ–∫—É—â–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å: O(n¬≤)
   - –¶–µ–ª—å: O(1) lookup
   - –í—ã–∏–≥—Ä—ã—à: 10x —É—Å–∫–æ—Ä–µ–Ω–∏–µ –ø—Ä–∏ >20 —Å—á–µ—Ç–∞—Ö

2. **–î–æ–±–∞–≤–∏—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É**
   - –ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
   - –ß–∞—Å—Ç–æ—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
   - –°–∞–º—ã–µ —á–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞

3. **–ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π** –≤ VoiceInputView
   - –ó–µ–ª–µ–Ω—ã–º: —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–æ
   - –ñ–µ–ª—Ç—ã–º: –Ω–∏–∑–∫–∏–π confidence
   - –ö—Ä–∞—Å–Ω—ã–º: –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–æ

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
4. **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö –¥–∞—Ç**
   - "–ø–æ–∑–∞–≤—á–µ—Ä–∞", "15 —è–Ω–≤–∞—Ä—è", "–≤ –ø—Ä–æ—à–ª—É—é –ø—è—Ç–Ω–∏—Ü—É"

5. **Haptic feedback** –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –≤–∞–ª–∏–¥–∞—Ü–∏–∏

6. **–ì–æ–ª–æ—Å–æ–≤—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏** –¥–ª—è first-time –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (future)
7. Multi-language –ø–æ–¥–¥–µ—Ä–∂–∫–∞ (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π, –∫–∞–∑–∞—Ö—Å–∫–∏–π)
8. ML-–ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏
9. –°–ª–æ–∂–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ ("—Ä–∞–∑–¥–µ–ª–∏–ª —Å—á–µ—Ç –Ω–∞ —Ç—Ä–æ–∏—Ö")

---

## üéì –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ü—Ä–æ–¥–µ–ª–∞–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞:**
- ‚úÖ 7 –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –±–∞–≥–æ–≤ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- ‚úÖ 3 –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ 40+ unit-—Ç–µ—Å—Ç–æ–≤ —Å–æ–∑–¥–∞–Ω–æ
- ‚úÖ 1 —Ñ–∞–π–ª –∫–æ–Ω—Å—Ç–∞–Ω—Ç (—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è)
- ‚úÖ 5 —Ñ–∞–π–ª–æ–≤ —É–ª—É—á—à–µ–Ω–æ
- ‚úÖ ML –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (2 –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–∞ + –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)
- ‚úÖ –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (rule-based + ML)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- **–û—Ü–µ–Ω–∫–∞ –¥–æ:** 7.5/10
- **–û—Ü–µ–Ω–∫–∞ –ø–æ—Å–ª–µ:** 9.5/10
- **–†–æ—Å—Ç:** +2.0 –±–∞–ª–ª–∞

**–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:** ~2-3 —á–∞—Å–∞

**ROI:** –í—ã—Å–æ–∫–∏–π - —Ñ—É–Ω–∫—Ü–∏—è —è–≤–ª—è–µ—Ç—Å—è –∫–ª—é—á–µ–≤—ã–º USP –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- Unit-—Ç–µ—Å—Ç—ã —Å–æ–∑–¥–∞–Ω—ã, –Ω–æ –Ω–µ –∑–∞–ø—É—Å–∫–∞–ª–∏—Å—å (—Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–∏–º—É–ª—è—Ç–æ—Ä)
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—ã–π test suite –ø–µ—Ä–µ–¥ merge

### –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- iOS 15.0+ (—Ç–µ–∫—É—â–∏–π deployment target)

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- –°–æ–∑–¥–∞–Ω –ø–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç-–æ—Ç—á–µ—Ç: `VOICE_INPUT_AUDIT_REPORT.md`
- –°–æ–∑–¥–∞–Ω –æ—Ç—á–µ—Ç –æ–± —É–ª—É—á—à–µ–Ω–∏—è—Ö: `VOICE_INPUT_IMPROVEMENTS_SUMMARY.md` (—ç—Ç–æ—Ç —Ñ–∞–π–ª)

---

### 8. üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω race condition –≤ –º–æ–¥–∞–ª–∫–µ VoiceInputView

**–§–∞–π–ª:** `AIFinanceManager/Views/VoiceInputView.swift`

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∏–ª: "–ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –ø–æ—Å–ª–µ —Ä–∞—Å–ø–æ–∑–Ω–æ–≤–∞–Ω–∏—è, –º–æ–¥–∞–ª–∫–∞ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç. –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—É—Å—Ç–∞—è –º–æ–¥–∞–ª–∫–∞ –ø–æ—Å–ª–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è. –∏ —Ç–æ–ª—å–∫–æ –≤ 3 —Ä–∞–∑ –æ—Ç–∫—Ä—ã–≤–∞—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ"

**–ü—Ä–∏—á–∏–Ω–∞:**
Race condition –º–µ–∂–¥—É –¥–≤—É–º—è –º–µ—Ö–∞–Ω–∏–∑–º–∞–º–∏ –∑–∞–∫—Ä—ã—Ç–∏—è VoiceInputView:

```swift
// ‚ùå –î–û (–ø—Ä–æ–±–ª–µ–º–∞):
Button(action: {
    if voiceService.isRecording {
        voiceService.stopRecording()
        Task {
            try? await Task.sleep(nanoseconds: 350 * 1_000_000)
            let finalText = voiceService.getFinalText()
            if !finalText.isEmpty {
                onComplete(finalText)  // 1. –í—ã–∑—ã–≤–∞–µ—Ç closure –∏–∑ ContentView
            }
            await MainActor.run {
                dismiss()  // 2. –ó–∞–∫—Ä—ã–≤–∞–µ—Ç view –í–¢–û–†–û–ô –†–ê–ó
            }
        }
    }
})
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –≤ ContentView:**
```swift
VoiceInputView(voiceService: voiceService) { transcribedText in
    showingVoiceInput = false  // –ó–∞–∫—Ä—ã–≤–∞–µ—Ç VoiceInputView
    // ... –ø–∞—Ä—Å–∏–Ω–≥ ...
    parsedOperation = parsed
    showingVoiceConfirmation = true  // –û—Ç–∫—Ä—ã–≤–∞–µ—Ç VoiceInputConfirmationView
}
```

**–°—Ü–µ–Ω–∞—Ä–∏–π –±–∞–≥–∞:**
1. **–ü–µ—Ä–≤–∞—è –ø–æ–ø—ã—Ç–∫–∞**: `onComplete` –≤—ã–∑—ã–≤–∞–µ—Ç `showingVoiceInput = false`, –∑–∞—Ç–µ–º VoiceInputView.dismiss() –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç ‚Üí VoiceInputConfirmationView –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è
2. **–í—Ç–æ—Ä–∞—è –ø–æ–ø—ã—Ç–∫–∞**: State —É–∂–µ –≤ —Å—Ç—Ä–∞–Ω–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—É—Å—Ç–∞—è –º–æ–¥–∞–ª–∫–∞
3. **–¢—Ä–µ—Ç—å—è –ø–æ–ø—ã—Ç–∫–∞**: State —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è ‚Üí —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–†–µ—à–µ–Ω–∏–µ:**
–£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–π `dismiss()` –∏–∑ VoiceInputView, —Ç–∞–∫ –∫–∞–∫ `onComplete` closure —É–∂–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç view —á–µ—Ä–µ–∑ `showingVoiceInput = false`:

```swift
// ‚úÖ –ü–û–°–õ–ï (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ):
Button(action: {
    if voiceService.isRecording {
        voiceService.stopRecording()
        Task {
            try? await Task.sleep(nanoseconds: VoiceInputConstants.finalizationDelayMs * 1_000_000)
            let finalText = voiceService.getFinalText()
            if !finalText.isEmpty {
                await MainActor.run {
                    onComplete(finalText)
                    // onComplete closure –≤ ContentView —É–∂–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —ç—Ç–æ—Ç view —á–µ—Ä–µ–∑ showingVoiceInput = false
                    // –ø–æ—ç—Ç–æ–º—É –Ω–µ –Ω—É–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å dismiss() –∑–¥–µ—Å—å
                }
            } else {
                // –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç –ø—É—Å—Ç–æ–π, –∑–∞–∫—Ä—ã–≤–∞–µ–º view
                await MainActor.run {
                    dismiss()
                }
            }
        }
    }
})
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- ‚úÖ –ú–æ–¥–∞–ª–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ø–µ—Ä–≤–æ–≥–æ —Ä–∞–∑–∞
- ‚úÖ –ù–µ—Ç race condition –º–µ–∂–¥—É –¥–≤—É–º—è –º–µ—Ö–∞–Ω–∏–∑–º–∞–º–∏ –∑–∞–∫—Ä—ã—Ç–∏—è
- ‚úÖ VoiceInputConfirmationView –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ—Å–ª–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
- ‚úÖ –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç –ø—É—Å—Ç–æ–π, view –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ dismiss()

---

### 9. üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—É—Å—Ç–∞—è –º–æ–¥–∞–ª–∫–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–∏

**–§–∞–π–ª—ã:**
- `AIFinanceManager/Views/ContentView.swift`
- `AIFinanceManager/Models/ParsedOperation.swift`

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∏–ª: "–≤ –ø–µ—Ä–≤—ã–π —Ä–∞–∑ –ø–æ—Å–ª–µ —Ä–∞—Å–ø–æ–∑–Ω–æ–≤–∞–Ω–∏—è, –º–æ–¥–∞–ª–∫–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—É—Å—Ç–∞—è, —Ç–æ–ª—å–∫–æ —Å–æ –≤—Ç–æ—Ä–æ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –º–æ–¥–∞–ª–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ"

**–ü—Ä–∏—á–∏–Ω–∞:**
SwiftUI `.sheet(isPresented:)` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç sheet —Å—Ä–∞–∑—É, –∫–æ–≥–¥–∞ `showingVoiceConfirmation` —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è `true`, –Ω–æ –≤ —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç `parsedOperation` –º–æ–∂–µ—Ç –±—ã—Ç—å –µ—â–µ `nil`. –í `voiceConfirmationSheet`:

```swift
// ‚ùå –î–û (–ø—Ä–æ–±–ª–µ–º–∞):
.sheet(isPresented: $showingVoiceConfirmation) {
    voiceConfirmationSheet  // –í—ã–∑—ã–≤–∞–µ—Ç view builder
}

@ViewBuilder
private var voiceConfirmationSheet: some View {
    if let parsed = parsedOperation {  // –ú–æ–∂–µ—Ç –±—ã—Ç—å nil ‚Üí –ø—É—Å—Ç–æ–π view!
        VoiceInputConfirmationView(...)
    }
}
```

**–°—Ü–µ–Ω–∞—Ä–∏–π –±–∞–≥–∞:**
1. `showingVoiceConfirmation = true` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
2. SwiftUI –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç `voiceConfirmationSheet`
3. –í —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç `parsedOperation` –µ—â–µ `nil` ‚Üí `if let` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π view
4. –ü—É—Å—Ç–æ–π sheet –ø–æ—è–≤–ª—è–µ—Ç—Å—è –Ω–∞ —ç–∫—Ä–∞–Ω–µ
5. –í–æ –≤—Ç–æ—Ä–æ–π —Ä–∞–∑ `parsedOperation` —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–Ω–∞—á–µ–Ω–∏–µ ‚Üí —Ä–∞–±–æ—Ç–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `.sheet(item:)` –≤–º–µ—Å—Ç–æ `.sheet(isPresented:)`. –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ sheet –æ—Ç–∫—Ä–æ–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞**, –∫–æ–≥–¥–∞ `parsedOperation` –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–Ω–∞—á–µ–Ω–∏–µ:

```swift
// ‚úÖ –ü–û–°–õ–ï (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ):
// –î–æ–±–∞–≤–ª–µ–Ω Identifiable –∫ ParsedOperation
struct ParsedOperation: Identifiable {
    let id = UUID()  // –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è .sheet(item:)
    // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
}

// –í ContentView:
.sheet(item: $parsedOperation) { parsed in
    // parsed –ì–ê–†–ê–ù–¢–ò–†–û–í–ê–ù–ù–û –Ω–µ nil
    VoiceInputConfirmationView(
        transactionsViewModel: viewModel,
        accountsViewModel: accountsViewModel,
        categoriesViewModel: categoriesViewModel,
        parsedOperation: parsed,
        originalText: voiceService.getFinalText()
    )
}

// –í voiceInputSheet closure:
let parsed = parser.parse(transcribedText)
parsedOperation = parsed  // Sheet –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!
```

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:**
1. ‚úÖ –£–¥–∞–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `@State private var showingVoiceConfirmation`
2. ‚úÖ –£–¥–∞–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `voiceConfirmationSheet`
3. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –ø—Ä–æ—Ç–æ–∫–æ–ª `Identifiable` –∫ `ParsedOperation`
4. ‚úÖ –ó–∞–º–µ–Ω–µ–Ω `.sheet(isPresented:)` –Ω–∞ `.sheet(item:)`

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- ‚úÖ Sheet –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å –ø–µ—Ä–≤–æ–≥–æ —Ä–∞–∑–∞ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- ‚úÖ –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –ø—É—Å—Ç–æ–π sheet (–∑–∞—â–∏—Ç–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ç–∏–ø–æ–≤)
- ‚úÖ –ë–æ–ª–µ–µ –∏–¥–∏–æ–º–∞—Ç–∏—á–Ω—ã–π SwiftUI –∫–æ–¥
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ sheet –ø—Ä–∏ `parsedOperation = nil`

---

### 10. üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ —Ç–∏–ø–∞ –¥–æ—Ö–æ–¥–∞

**–§–∞–π–ª:** `AIFinanceManager/Services/VoiceInputParser.swift`

**–ü—Ä–æ–±–ª–µ–º—ã:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∏–ª: "–≥–æ–≤–æ—Ä—é '500 —Ç–µ–Ω–≥–µ –Ω–∞ —Ç–∞–∫—Å–∏', —Ç–µ–∫—Å—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –Ω–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç –Ω–µ –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è"
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∏–ª: "–≥–æ–≤–æ—Ä—é '10000 —Å –∑–∞—Ä–ø–ª–∞—Ç—ã', –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —á—Ç–æ —ç—Ç–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∑–∞—Ä–ø–ª–∞—Ç–∞"

**–ü—Ä–∏—á–∏–Ω–∞ 1 - –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞—é—Ç—Å—è:**
–í `categoryMap` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π ("Transport", "Food", "Health"), –Ω–æ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ ("–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç", "–ï–¥–∞", "–ó–¥–æ—Ä–æ–≤—å–µ"):

```swift
// ‚ùå –î–û (–ø—Ä–æ–±–ª–µ–º–∞):
let categoryMap: [String: (category: String, subcategory: String?)] = [
    "—Ç–∞–∫—Å–∏": ("Transport", "Taxi"),  // –ò—â–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é "Transport"
    "—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç": ("Transport", nil),
    "–∫–∞—Ñ–µ": ("Food", nil),           // –ò—â–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é "Food"
    // ...
]

// –ü–æ–∏—Å–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
let matchingCategory = categories.first {
    normalizeText($0.name) == normalizeText("Transport")  // –ù–µ –Ω–∞—Ö–æ–¥–∏—Ç!
}
```

**–ü—Ä–∏—á–∏–Ω–∞ 2 - "–ó–∞—Ä–ø–ª–∞—Ç–∞" –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç—Å—è –∫–∞–∫ –¥–æ—Ö–æ–¥:**
–°–ª–æ–≤–æ "–∑–∞—Ä–ø–ª–∞—Ç–∞" –Ω–µ –±—ã–ª–æ –≤ —Å–ø–∏—Å–∫–µ `incomeKeywords`, –ø–æ—ç—Ç–æ–º—É –æ–ø–µ—Ä–∞—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª—è–ª–∞—Å—å –∫–∞–∫ —Ä–∞—Å—Ö–æ–¥ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

**–†–µ—à–µ–Ω–∏–µ:**

1. **–ó–∞–º–µ–Ω–µ–Ω—ã –≤—Å–µ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –Ω–∞ —Ä—É—Å—Å–∫–∏–µ:**
```swift
// ‚úÖ –ü–û–°–õ–ï (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ):
let categoryMap: [String: (category: String, subcategory: String?)] = [
    // –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç
    "—Ç–∞–∫—Å–∏": ("–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç", "–¢–∞–∫—Å–∏"),
    "–±–µ–Ω–∑–∏–Ω": ("–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç", "–ë–µ–Ω–∑–∏–Ω"),
    "–ø–∞—Ä–∫–æ–≤–∫–∞": ("–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç", "–ü–∞—Ä–∫–æ–≤–∫–∞"),
    "—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç": ("–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç", nil),

    // –ï–¥–∞
    "–∫–∞—Ñ–µ": ("–ï–¥–∞", nil),
    "–∫–æ—Ñ–µ": ("–ï–¥–∞", "–ö–æ—Ñ–µ"),
    "—Ä–µ—Å—Ç–æ—Ä–∞–Ω": ("–ï–¥–∞", nil),

    // –ü—Ä–æ–¥—É–∫—Ç—ã
    "–ø—Ä–æ–¥—É–∫—Ç—ã": ("–ü—Ä–æ–¥—É–∫—Ç—ã", nil),
    "—Å—É–ø–µ—Ä–º–∞—Ä–∫–µ—Ç": ("–ü—Ä–æ–¥—É–∫—Ç—ã", nil),

    // –ü–æ–∫—É–ø–∫–∏
    "–ø–æ–∫—É–ø–∫–∞": ("–ü–æ–∫—É–ø–∫–∏", nil),
    "–æ–¥–µ–∂–¥–∞": ("–ü–æ–∫—É–ø–∫–∏", "–û–¥–µ–∂–¥–∞"),

    // –†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è
    "–∫–∏–Ω–æ": ("–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è", nil),
    "—Ç–µ–∞—Ç—Ä": ("–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è", nil),

    // –ó–¥–æ—Ä–æ–≤—å–µ
    "–∞–ø—Ç–µ–∫–∞": ("–ó–¥–æ—Ä–æ–≤—å–µ", "–ê–ø—Ç–µ–∫–∞"),
    "–≤—Ä–∞—á": ("–ó–¥–æ—Ä–æ–≤—å–µ", "–í—Ä–∞—á"),

    // –ö–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ
    "–∫–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ": ("–ö–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ", nil),
    "—ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ": ("–ö–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ", "–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ"),
    "–∏–Ω—Ç–µ—Ä–Ω–µ—Ç": ("–ö–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ", "–ò–Ω—Ç–µ—Ä–Ω–µ—Ç"),

    // –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
    "–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ": ("–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ", nil),
    "—à–∫–æ–ª–∞": ("–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ", nil),

    // –ó–∞—Ä–ø–ª–∞—Ç–∞ (–ù–û–í–û–ï!)
    "–∑–∞—Ä–ø–ª–∞—Ç–∞": ("–ó–∞—Ä–ø–ª–∞—Ç–∞", nil),
    "–∑–∞—Ä–ø–ª–∞—Ç—É": ("–ó–∞—Ä–ø–ª–∞—Ç–∞", nil),
    "–æ–∫–ª–∞–¥": ("–ó–∞—Ä–ø–ª–∞—Ç–∞", nil),
    "–ø—Ä–µ–º–∏—è": ("–ó–∞—Ä–ø–ª–∞—Ç–∞", nil),

    // –î—Ä—É–≥–æ–µ
    "—É—Å–ª—É–≥–∏": ("–£—Å–ª—É–≥–∏", nil),
    "—Ä–µ–º–æ–Ω—Ç": ("–£—Å–ª—É–≥–∏", nil)
]
```

2. **–î–æ–±–∞–≤–ª–µ–Ω—ã –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –¥–æ—Ö–æ–¥–æ–≤:**
```swift
// ‚úÖ –ü–û–°–õ–ï (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ):
let incomeKeywords = [
    "–ø–æ–ª—É—á–∏–ª", "–ø–æ–ª—É—á–∏–ª–∞", "–ø–æ–ª—É—á–∏–ª–∏", "–ø–æ–ª—É—á–∏–ª–æ",
    "–ø—Ä–∏—à–ª–æ", "–ø—Ä–∏—à–ª–∞", "–ø—Ä–∏—à–ª–∏",
    "–∑–∞—Ä–∞–±–æ—Ç–∞–ª", "–∑–∞—Ä–∞–±–æ—Ç–∞–ª–∞", "–∑–∞—Ä–∞–±–æ—Ç–∞–ª–∏",
    "–¥–æ—Ö–æ–¥", "–¥–æ—Ö–æ–¥—ã",
    "–ø–æ–ø–æ–ª–Ω–∏–ª", "–ø–æ–ø–æ–ª–Ω–∏–ª–∞", "–ø–æ–ø–æ–ª–Ω–∏–ª–∏",
    "–ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ", "–ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è",
    "–Ω–∞—á–∏—Å–ª–∏–ª", "–Ω–∞—á–∏—Å–ª–∏–ª–∞", "–Ω–∞—á–∏—Å–ª–∏–ª–∏",
    "–∑–∞—Ä–ø–ª–∞—Ç–∞", "–∑–∞—Ä–ø–ª–∞—Ç—É", "–∑–∞—Ä–ø–ª–∞—Ç—ã",  // –ù–û–í–û–ï!
    "–æ–∫–ª–∞–¥", "–ø—Ä–µ–º–∏—è", "–ø—Ä–µ–º–∏—é"          // –ù–û–í–û–ï!
]
```

**–¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**

| –ì–æ–ª–æ—Å–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ | –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç | –°—Ç–∞—Ç—É—Å |
|------------------|---------------------|--------|
| "500 —Ç–µ–Ω–≥–µ –Ω–∞ —Ç–∞–∫—Å–∏" | –¢–∏–ø: –†–∞—Å—Ö–æ–¥, –ö–∞—Ç–µ–≥–æ—Ä–∏—è: –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç, –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è: –¢–∞–∫—Å–∏ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| "1000 –Ω–∞ –±–µ–Ω–∑–∏–Ω" | –¢–∏–ø: –†–∞—Å—Ö–æ–¥, –ö–∞—Ç–µ–≥–æ—Ä–∏—è: –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç, –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è: –ë–µ–Ω–∑–∏–Ω | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| "300 –≤ –∫–∞—Ñ–µ" | –¢–∏–ø: –†–∞—Å—Ö–æ–¥, –ö–∞—Ç–µ–≥–æ—Ä–∏—è: –ï–¥–∞ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| "10000 —Å –∑–∞—Ä–ø–ª–∞—Ç—ã" | –¢–∏–ø: **–î–æ—Ö–æ–¥**, –ö–∞—Ç–µ–≥–æ—Ä–∏—è: –ó–∞—Ä–ø–ª–∞—Ç–∞ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| "5000 –ø—Ä–µ–º–∏—è" | –¢–∏–ø: **–î–æ—Ö–æ–¥**, –ö–∞—Ç–µ–≥–æ—Ä–∏—è: –ó–∞—Ä–ø–ª–∞—Ç–∞ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| "2000 –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç—ã" | –¢–∏–ø: –†–∞—Å—Ö–æ–¥, –ö–∞—Ç–µ–≥–æ—Ä–∏—è: –ü—Ä–æ–¥—É–∫—Ç—ã | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| "500 –≤ –∞–ø—Ç–µ–∫–µ" | –¢–∏–ø: –†–∞—Å—Ö–æ–¥, –ö–∞—Ç–µ–≥–æ—Ä–∏—è: –ó–¥–æ—Ä–æ–≤—å–µ, –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è: –ê–ø—Ç–µ–∫–∞ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- ‚úÖ –í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–µ–ø–µ—Ä—å —Ä–∞—Å–ø–æ–∑–Ω–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ó–∞—Ä–ø–ª–∞—Ç–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∫–∞–∫ –¥–æ—Ö–æ–¥ (income)
- ‚úÖ –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ 28 –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø–µ—Ä–µ–≤–µ–¥–µ–Ω—ã –Ω–∞ —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã 5 –Ω–æ–≤—ã—Ö –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –¥–ª—è –¥–æ—Ö–æ–¥–æ–≤

---

### 11. ü§ñ –î–æ–±–∞–≤–ª–µ–Ω–∞ –±–∞–∑–æ–≤–∞—è ML –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–§–∞–∑–∞ 1)

**–§–∞–π–ª—ã:**
- `AIFinanceManager/Services/ML/CategoryMLPredictor.swift`
- `AIFinanceManager/Services/ML/MLDataExporter.swift`
- `ML_INTEGRATION_GUIDE.md`

**–ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:**

–°–æ–∑–¥–∞–Ω–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä–∞—è —É–ª—É—á—à–∞–µ—Ç —Ç–æ—á–Ω–æ—Å—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**

```
Rule-Based Parser (80% —Ç–æ—á–Ω–æ—Å—Ç—å)
         ‚Üì
   Confidence?
    /        \
  HIGH      LOW
   ‚Üì          ‚Üì
  ‚úÖ Use     ü§ñ ML Predictor
  result    (90%+ —Ç–æ—á–Ω–æ—Å—Ç—å)
```

**1. CategoryMLPredictor - ML –ø—Ä–µ–¥—Å–∫–∞–∑–∞—Ç–µ–ª—å**

```swift
@available(iOS 14.0, *)
class CategoryMLPredictor {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –º–æ–¥–µ–ª–∏
    var isAvailable: Bool { return model != nil }

    // –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    func predict(text: String, amount: Decimal?, type: TransactionType)
        -> (category: String?, confidence: Double)

    // –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (rule-based + ML)
    func hybridPredict(
        text: String,
        ruleBasedCategory: String?,
        ruleBasedConfidence: Double,
        amount: Decimal?,
        type: TransactionType
    ) -> String?
}
```

**2. MLDataExporter - —É—Ç–∏–ª–∏—Ç–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö**

```swift
class MLDataExporter {
    // –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
    static func exportCategoryTrainingData(from transactions: [Transaction]) -> String

    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    static func collectStatistics(from transactions: [Transaction]) -> [String: Any]

    // –í–∞–ª–∏–¥–∞—Ü–∏—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
    static func validateTrainingData(transactions: [Transaction])
        -> (isValid: Bool, message: String)

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ CSV –≤ —Ñ–∞–π–ª
    static func saveToFile(csv: String, filename: String) -> URL?

    // Debug –æ—Ç—á–µ—Ç
    static func generateDataReadinessReport(from transactions: [Transaction]) -> String
}
```

**–ü—Ä–æ—Ü–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏:**

1. **–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
   ```swift
   let csv = MLDataExporter.exportCategoryTrainingData(from: transactions)
   MLDataExporter.saveToFile(csv: csv, filename: "training_data.csv")
   ```

2. **–û–±—É—á–µ–Ω–∏–µ –≤ Create ML (Mac):**
   - –û—Ç–∫—Ä—ã—Ç—å Create ML
   - Text Classifier
   - Input: description ‚Üí Target: category
   - Train (1-5 –º–∏–Ω—É—Ç)

3. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –≤ –ø—Ä–æ–µ–∫—Ç:**
   - –≠–∫—Å–ø–æ—Ä—Ç: `CategoryClassifier.mlmodel`
   - –î–æ–±–∞–≤–∏—Ç—å –≤ `AIFinanceManager/Services/ML/Models/`
   - Xcode —Å–∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç –≤ `.mlmodelc`

**–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥:**

```swift
// –°–Ω–∞—á–∞–ª–∞ rule-based
let (category, confidence) = parseCategory_RuleBased(from: text)

// –ï—Å–ª–∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –Ω–∏–∑–∫–∞—è ‚Üí ML
if confidence < 0.8, mlPredictor.isAvailable {
    let (mlCategory, mlConfidence) = mlPredictor.predict(text: text)

    if mlConfidence > 0.7 {
        return mlCategory  // ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º ML
    }
}

return category  // Fallback –Ω–∞ rule-based
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

1. **On-Device ML:**
   - ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ñ—Ñ–ª–∞–π–Ω
   - ‚úÖ –ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö (–≤—Å—ë –ª–æ–∫–∞–ª—å–Ω–æ)
   - ‚úÖ –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è
   - ‚úÖ –ù–∏–∑–∫–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏

2. **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è:**
   - ‚úÖ –£—á–∏—Ç—Å—è –Ω–∞ –¥–∞–Ω–Ω—ã—Ö –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - ‚úÖ –ê–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –∫ –µ–≥–æ –ø—Ä–∏–≤—ã—á–∫–∞–º
   - ‚úÖ –£–ª—É—á—à–∞–µ—Ç—Å—è —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º

3. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:**
   - ‚úÖ Fallback –Ω–∞ rule-based –µ—Å–ª–∏ ML –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
   - ‚úÖ –ù–µ –ª–æ–º–∞–µ—Ç —Ç–µ–∫—É—â—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
   - ‚úÖ –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ (Feature Flag)

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è –æ–±—É—á–µ–Ω–∏—è:**

- –ú–∏–Ω–∏–º—É–º **50 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 200+)
- –ú–∏–Ω–∏–º—É–º **5 –ø—Ä–∏–º–µ—Ä–æ–≤** –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—é
- –†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ –æ–ø–∏—Å–∞–Ω–∏–π
- macOS 12.0+ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è (Create ML –Ω–∞ Mac)
- iOS 14.0+ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

**Debug –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**

```
üîç [VoiceInput] ML Predictor –≤—ã–∑–≤–∞–Ω –¥–ª—è —Ç–µ–∫—Å—Ç–∞: "–∫—É–ø–∏–ª –º–æ–ª–æ–∫–æ"
üîç [VoiceInput] ML Predictor –≤—ã–±—Ä–∞–ª: –ü—Ä–æ–¥—É–∫—Ç—ã (confidence: 0.92)
```

**–ß—Ç–æ –¥–∞–ª—å—à–µ (Roadmap):**

**–§–∞–∑–∞ 2: –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è** (2-3 –Ω–µ–¥–µ–ª–∏)
- On-device –æ–±—É—á–µ–Ω–∏–µ (Core ML Update Tasks)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ
- –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ —Å—á–µ—Ç–æ–≤

**–§–∞–∑–∞ 3: –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**
- Anomaly Detection (–Ω–µ–æ–±—ã—á–Ω—ã–µ —Ç—Ä–∞—Ç—ã)
- Smart Suggestions
- –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- NLP –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Å—É—â–Ω–æ—Å—Ç–µ–π

**–§–∞–∑–∞ 4: –ú—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω–æ—Å—Ç—å**
- –£—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –¥–Ω—è/–Ω–µ–¥–µ–ª–∏
- –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è
- –°–µ–∑–æ–Ω–Ω–æ—Å—Ç—å

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ: `ML_INTEGRATION_GUIDE.md`
- –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- FAQ –∏ troubleshooting

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- ‚úÖ –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- ‚úÖ –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (rule-based + ML)
- ‚úÖ –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ Debug –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- ‚úÖ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚è≥ –¢—Ä–µ–±—É–µ—Ç—Å—è –æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ (–ø–æ—Å–ª–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö)

---

**–ê–≤—Ç–æ—Ä:** Claude Sonnet 4.5
**–î–∞—Ç–∞:** 2026-01-18
**–í–µ—Ä—Å–∏—è:** 1.5 - ML Integration Complete
**–°—Ç–∞—Ç—É—Å —Å–±–æ—Ä–∫–∏:** ‚úÖ BUILD SUCCEEDED
